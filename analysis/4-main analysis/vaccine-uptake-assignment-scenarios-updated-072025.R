########################################################################################################################
#Title: Updated booster uptake assignment
#Author: Hailey Park
#Date: January 16th, 2025
########################################################################################################################

#Vaccination Assignment under updated booster coverages (realistic)
#Assign who is getting vaccinated using age-specific and risk-specific coverage rates. Second updated booster coverage in higher risk 
#groups (65+ years, high risk + immunocompromised) also accounted for with the `vax_2` variable

realistic_vax_assignment_updated <- function(df, first_dose_data, second_dose_data, next_year_dose_data, realistic_ind){
  
  #Assign who is getting vaccinated using age-specific and risk-specific coverage rates
  # NOTE: `vax` and `vax_2` assigns who will get 1st and 2nd boosters based on coverage rates.
  #       `vaccine_wave` and `second_vaccine_wave` assigns when those boosters are administered based on historic uptake
  vax_assignment <- df %>% mutate(vax = 0, vax_2 = 0, vax_val = 0, vaccine_wave = 0, second_vaccine_wave = 0, vaccine_wave_val = 0)
  
  #For 0-17 years age bin, assume that 96.7% of 0-17 years are older than 6 months (CRUDE ASSUMPTION)
  age_0_17_index <- which(vax_assignment$age_group == "0-17 years")
  age_0_17_index <- sample(age_0_17_index, length(age_0_17_index) * 0.967)
  
  age_18_29_index <- which(vax_assignment$age_group == "18-29 years")
  age_30_49_index <- which(vax_assignment$age_group == "30-49 years")
  age_50_64_index <- which(vax_assignment$age_group == "50-64 years")
  age_65_74_index <- which(vax_assignment$age_group == "65-74 years")
  age_75_plus_index <- which(vax_assignment$age_group == "75+ years")
  
  risk_healthy_index <- which(vax_assignment$risk_group == "healthy")
  risk_highrisk_index <- which(vax_assignment$risk_group == "higher risk")
  risk_immuno_index <- which(vax_assignment$risk_group == "immunocompromised")
  
  vaccinated <- which(vax_assignment$prior_vacc != "unvax")
  
  
  vax_assignment$vax[Reduce(intersect, list(age_0_17_index,risk_healthy_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_0_17_index,risk_healthy_index,vaccinated))), 1, 0.13 * length(Reduce(intersect, list(age_0_17_index,risk_healthy_index)))/length(Reduce(intersect, list(age_0_17_index,risk_healthy_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_0_17_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_0_17_index,risk_highrisk_index,vaccinated))), 1, 0.235 * length(Reduce(intersect, list(age_0_17_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_0_17_index,risk_highrisk_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_0_17_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_0_17_index,risk_immuno_index,vaccinated))), 1, 0.235 * length(Reduce(intersect, list(age_0_17_index,risk_immuno_index)))/length(Reduce(intersect, list(age_0_17_index,risk_immuno_index,vaccinated))))
  
  vax_assignment$vax[Reduce(intersect, list(age_18_29_index,risk_healthy_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_18_29_index,risk_healthy_index,vaccinated))), 1, 0.0926 * length(Reduce(intersect, list(age_18_29_index,risk_healthy_index)))/length(Reduce(intersect, list(age_18_29_index,risk_healthy_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_18_29_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index,vaccinated))), 1, 0.1668 * length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_18_29_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,vaccinated))), 1, 0.1668 * length(Reduce(intersect, list(age_18_29_index,risk_immuno_index)))/length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,vaccinated))))
  
  vax_assignment$vax[Reduce(intersect, list(age_30_49_index,risk_healthy_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_30_49_index,risk_healthy_index,vaccinated))), 1, 0.1308 * length(Reduce(intersect, list(age_30_49_index,risk_healthy_index)))/length(Reduce(intersect, list(age_30_49_index,risk_healthy_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_30_49_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index,vaccinated))), 1, 0.2355 * length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_30_49_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,vaccinated))), 1, 0.2355 * length(Reduce(intersect, list(age_30_49_index,risk_immuno_index)))/length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,vaccinated))))
  
  vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_healthy_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_50_64_index,risk_healthy_index,vaccinated))), 1, 0.1439 * length(Reduce(intersect, list(age_50_64_index,risk_healthy_index)))/length(Reduce(intersect, list(age_50_64_index,risk_healthy_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index,vaccinated))), 1, 0.2591 * length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,vaccinated))), 1, 0.2591 * length(Reduce(intersect, list(age_50_64_index,risk_immuno_index)))/length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,vaccinated))))
  
  vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_healthy_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_65_74_index,risk_healthy_index,vaccinated))), 1, 0.2228 * length(Reduce(intersect, list(age_65_74_index,risk_healthy_index)))/length(Reduce(intersect, list(age_65_74_index,risk_healthy_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index,vaccinated))), 1, 0.4010 * length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_65_74_index,risk_immuno_index,vaccinated))), 1, 0.4010 * length(Reduce(intersect, list(age_65_74_index,risk_immuno_index)))/length(Reduce(intersect, list(age_65_74_index,risk_immuno_index,vaccinated))))
  
  vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index,vaccinated))), 1, 0.221 * length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index)))/length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,vaccinated))), 1, 0.3979 * length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index,vaccinated))), 1, 0.3979 * length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index)))/length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index,vaccinated))))
  
  print(paste0("Percentage of 0-17 years receiving vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$vax == 1))/(length(which(vax_assignment$age_group == "0-17 years"))* 0.967)))
  print(paste0("Percentage of 18-29 years receiving vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "18-29 years"))))
  print(paste0("Percentage of 30-49 years receiving vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "30-49 years"))))
  print(paste0("Percentage of 50-64 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "50-64 years"))))
  print(paste0("Percentage of 65-74 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "65-74 years"))))
  print(paste0("Percentage of 75+ years receiving vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "75+ years"))))
  print("0.15, 0.113, 0.1596, 0.217, 0.3794, 0.3764")
  
  print(paste0("0-17 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy"))* 0.967)))
  print(paste0("18-29 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy"))))
  print(paste0("30-49 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy"))))
  print(paste0("50-64 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy"))))
  print(paste0("65-74 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy"))))
  print(paste0("75+ years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy"))))
  
  print(paste0("0-17 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk"))* 0.967)))
  print(paste0("18-29 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk"))))
  print(paste0("30-49 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk"))))
  print(paste0("50-64 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk"))))
  print(paste0("65-74 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk"))))
  print(paste0("75+ years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk"))))
  
  print(paste0("0-17 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised"))* 0.967)))
  print(paste0("18-29 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised"))))
  print(paste0("30-49 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised"))))
  print(paste0("50-64 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised"))))
  print(paste0("65-74 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised"))))
  print(paste0("75+ years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised"))))
  
  #Assign who is getting the second dose of the updated booster (filter among individuals who have already been assigned with receiving 1 updated booster) 
  second_dose <- which(vax_assignment$vax == 1)
  
  # vax_assignment$vax_2[Reduce(intersect, list(age_18_29_index,risk_highrisk_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index,second_dose))), 1, 0.054 * length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index,second_dose))))
  vax_assignment$vax_2[Reduce(intersect, list(age_18_29_index,risk_immuno_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,second_dose))), 1, 0.054 * length(Reduce(intersect, list(age_18_29_index,risk_immuno_index)))/length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,second_dose))))
  
  # vax_assignment$vax_2[Reduce(intersect, list(age_30_49_index,risk_highrisk_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index,second_dose))), 1, 0.054 * length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index,second_dose))))
  vax_assignment$vax_2[Reduce(intersect, list(age_30_49_index,risk_immuno_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,second_dose))), 1, 0.054 * length(Reduce(intersect, list(age_30_49_index,risk_immuno_index)))/length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,second_dose))))
  
  # vax_assignment$vax_2[Reduce(intersect, list(age_50_64_index,risk_highrisk_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index,second_dose))), 1, 0.054 * length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index,second_dose))))
  vax_assignment$vax_2[Reduce(intersect, list(age_50_64_index,risk_immuno_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,second_dose))), 1, 0.054 * length(Reduce(intersect, list(age_50_64_index,risk_immuno_index)))/length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,second_dose))))
  
  vax_assignment$vax_2[Reduce(intersect, list(age_65_74_index, second_dose))] <- rbinom(length(Reduce(intersect, list(age_65_74_index, second_dose))), 1, 0.089 * length(Reduce(intersect, list(age_65_74_index)))/length(Reduce(intersect, list(age_65_74_index,second_dose))))
  vax_assignment$vax_2[Reduce(intersect, list(age_75_plus_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_75_plus_index, second_dose))), 1, 0.089 * length(Reduce(intersect, list(age_75_plus_index)))/length(Reduce(intersect, list(age_75_plus_index,second_dose))))
  
  print(paste0("Percentage of immunocompromised receiving second dose: ",  length(which(vax_assignment$risk_group %in% c("immunocompromised") & vax_assignment$vax_2 == 1))/length(which(vax_assignment$risk_group %in% c("immunocompromised")))))
  print(paste0("Percentage of 65-74 years receiving second dose: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$vax_2 == 1))/length(which(vax_assignment$age_group == "65-74 years"))))
  print(paste0("Percentage of 75+ years receiving second dose: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$vax_2 == 1))/length(which(vax_assignment$age_group == "75+ years"))))
  
  #Assign who will receive the updated booster (validation period)
  val_dose <- which(vax_assignment$vax_2 == 1)
  vax_assignment$vax_val[Reduce(intersect, list(age_0_17_index,risk_healthy_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_0_17_index,risk_healthy_index,second_dose))), 1, 0.1194 * length(Reduce(intersect, list(age_0_17_index,risk_healthy_index)))/length(Reduce(intersect, list(age_0_17_index,risk_healthy_index,second_dose))))
  vax_assignment$vax_val[Reduce(intersect, list(age_0_17_index,risk_highrisk_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_0_17_index,risk_highrisk_index,second_dose))]
  vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_0_17_index,risk_highrisk_index)), second_dose), round(length(Reduce(intersect, list(age_0_17_index,risk_highrisk_index))) * (0.2397 - 0.235)))] <- 1
  vax_assignment$vax_val[Reduce(intersect, list(age_0_17_index,risk_immuno_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_0_17_index,risk_immuno_index,second_dose))]
  vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_0_17_index,risk_immuno_index)), second_dose), round(length(Reduce(intersect, list(age_0_17_index,risk_immuno_index))) * (0.2397 - 0.235)))] <- 1
  
  vax_assignment$vax_val[Reduce(intersect, list(age_18_29_index,risk_healthy_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_18_29_index,risk_healthy_index,second_dose))), 1, 0.0758 * length(Reduce(intersect, list(age_18_29_index,risk_healthy_index)))/length(Reduce(intersect, list(age_18_29_index,risk_healthy_index,second_dose))))
  vax_assignment$vax_val[Reduce(intersect, list(age_18_29_index,risk_highrisk_index,val_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_18_29_index,risk_highrisk_index,val_dose))]
  vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_18_29_index,risk_highrisk_index, second_dose)), val_dose), round(length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index)))  * (0.1521 + 0.05 - 0.054)))] <- 1
  vax_assignment$vax_val[Reduce(intersect, list(age_18_29_index,risk_immuno_index,val_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_18_29_index,risk_immuno_index,val_dose))]
  vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_18_29_index,risk_immuno_index, second_dose)), val_dose), round(length(Reduce(intersect, list(age_18_29_index,risk_immuno_index))) * (0.1521 - 0.054)))] <- 1
  
  vax_assignment$vax_val[Reduce(intersect, list(age_30_49_index,risk_healthy_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_30_49_index,risk_healthy_index,second_dose))), 1, 0.121 * length(Reduce(intersect, list(age_30_49_index,risk_healthy_index)))/length(Reduce(intersect, list(age_30_49_index,risk_healthy_index,second_dose))))
  vax_assignment$vax_val[Reduce(intersect, list(age_30_49_index,risk_highrisk_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_30_49_index,risk_highrisk_index,second_dose))]
  vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_30_49_index,risk_highrisk_index)), second_dose), round(length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index))) * (0.2428 - 0.2355)))] <- 1
  vax_assignment$vax_val[Reduce(intersect, list(age_30_49_index,risk_immuno_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_30_49_index,risk_immuno_index,second_dose))]
  vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_30_49_index,risk_immuno_index)), second_dose), round(length(Reduce(intersect, list(age_30_49_index,risk_immuno_index))) * (0.2428 - 0.2355)))] <- 1
  
  
  vax_assignment$vax_val[Reduce(intersect, list(age_50_64_index,risk_healthy_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_healthy_index,second_dose))]
  vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_50_64_index,risk_healthy_index)), second_dose), round(length(Reduce(intersect, list(age_50_64_index,risk_healthy_index))) * (0.1471 - 0.1439)))] <- 1
  vax_assignment$vax_val[Reduce(intersect, list(age_50_64_index,risk_highrisk_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_highrisk_index,second_dose))]
  vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_50_64_index,risk_highrisk_index)), second_dose), round(length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index))) * (0.2953 - 0.2591)))] <- 1
  vax_assignment$vax_val[Reduce(intersect, list(age_50_64_index,risk_immuno_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_immuno_index,second_dose))]
  vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_50_64_index,risk_immuno_index)), second_dose), round(length(Reduce(intersect, list(age_50_64_index,risk_immuno_index))) * (0.2953 - 0.2591)))] <- 1
  
  vax_assignment$vax_val[Reduce(intersect, list(age_65_74_index,risk_healthy_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_healthy_index,second_dose))]
  vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_65_74_index,risk_healthy_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_65_74_index,risk_healthy_index)), second_dose)) * (0.2334 - 0.2228)))] <- 1
  vax_assignment$vax_val[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,second_dose))]
  vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_65_74_index,risk_highrisk_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_65_74_index,risk_highrisk_index)), second_dose)) * (0.4685 - 0.3710)))] <- 1
  vax_assignment$vax_val[Reduce(intersect, list(age_65_74_index,risk_immuno_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_immuno_index,second_dose))]
  vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_65_74_index,risk_immuno_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_65_74_index,risk_immuno_index)), second_dose)) * (0.4685 - 0.3710)))] <- 1
  
  vax_assignment$vax_val[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,second_dose))]
  vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_75_plus_index,risk_healthy_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_75_plus_index,risk_healthy_index)), second_dose)) * (0.254 - 0.221)))] <- 1
  vax_assignment$vax_val[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,second_dose))]
  vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index)), second_dose)) * (0.5097 - 0.3379)))] <- 1
  vax_assignment$vax_val[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,second_dose))]
  vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_75_plus_index,risk_immuno_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_75_plus_index,risk_immuno_index)), second_dose)) * (0.5097 - 0.3379)))] <- 1

  print(paste0("Percentage of 0-17 years receiving vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years"))* 0.967)))
  print(paste0("Percentage of 18-29 years receiving vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years"))))
  print(paste0("Percentage of 30-49 years receiving vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years"))))
  print(paste0("Percentage of 50-64 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years"))))
  print(paste0("Percentage of 65-74 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years"))))
  print(paste0("Percentage of 75+ years receiving vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years"))))
  
  print(paste0("0-17 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy")) * 0.967)))
  print(paste0("18-29 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy"))))
  print(paste0("30-49 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy"))))
  print(paste0("50-64 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy"))))
  print(paste0("65-74 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy"))))
  print(paste0("75+ years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy"))))
  print("0.1336, 0.0967, 0.1543, 0.2411, 0.4393, 0.478")
  
  print(paste0("0-17 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk"))* 0.967)))
  print(paste0("18-29 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk"))))
  print(paste0("30-49 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk"))))
  print(paste0("50-64 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk"))))
  print(paste0("65-74 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk"))))
  print(paste0("75+ years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk"))))
  
  print(paste0("0-17 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised"))* 0.967)))
  print(paste0("18-29 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised"))))
  print(paste0("30-49 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised"))))
  print(paste0("50-64 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised"))))
  print(paste0("65-74 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised"))))
  print(paste0("75+ years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised"))))
  
  #distribute booster uptake over next 365 days, according to age distributions
  to_vaccinate_index <- which(vax_assignment$vax == 1)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_0_17_index,risk_healthy_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_0_17_index,risk_healthy_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "0-17 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "0-17 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_0_17_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_0_17_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "0-17 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "0-17 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_0_17_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_0_17_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "0-17 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "0-17 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_18_29_index,risk_healthy_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_18_29_index,risk_healthy_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "18-29 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "18-29 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_18_29_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "18-29 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "18-29 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_18_29_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "18-29 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "18-29 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_30_49_index,risk_healthy_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_30_49_index,risk_healthy_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_30_49_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_50_64_index,risk_healthy_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_50_64_index,risk_healthy_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_50_64_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "75+ years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "75+ years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "75+ years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "75+ years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "75+ years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "75+ years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  #distribute second dose booster uptake over next 365 days, according to age distributions
  to_vaccinate_second_index <- which(vax_assignment$vax_2 == 1)
  
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_18_29_index,risk_immuno_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "18-29 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "30-49 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "50-64 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "65-74 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "65-74 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "65-74 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "75+ years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "75+ years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "75+ years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  #distribute booster uptake over next 182 days, according to age distributions
  to_vaccinate_index <- which(vax_assignment$vax_val == 1)
  
  vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_0_17_index,risk_healthy_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_0_17_index,risk_healthy_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "0-17 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_0_17_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_0_17_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "0-17 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_0_17_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_0_17_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "0-17 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_18_29_index,risk_healthy_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_18_29_index,risk_healthy_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "18-29 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_18_29_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "18-29 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_18_29_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "18-29 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_30_49_index,risk_healthy_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_30_49_index,risk_healthy_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "30-49 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_30_49_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "30-49 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "30-49 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_50_64_index,risk_healthy_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_50_64_index,risk_healthy_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "50-64 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_50_64_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "50-64 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "50-64 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "65-74 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "65-74 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "65-74 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "75+ years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "75+ years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "75+ years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  return(vax_assignment %>% arrange(individual))
}

#Vaccination Assignment under different strategies
#Assign who is getting vaccinated using age-specific and risk-specific coverage rates. Second updated booster coverage in higher risk 
#groups (65+ years, high risk + immunocompromised) also accounted for with the `vax_2` variable

#Strategy 0: No vaccination
strategy_0 <- function(df, first_dose_data, second_dose_data, next_year_dose_data, realistic_ind){
  
  #Assign who is getting vaccinated using age-specific and risk-specific coverage rates
  # NOTE: `vax` and `vax_2` assigns who will get 1st and 2nd boosters based on coverage rates.
  #       `vaccine_wave` and `second_vaccine_wave` assigns when those boosters are administered based on historic uptake
  vax_assignment <- df %>% mutate(vax = 0, vax_2 = 0, vax_val = 0, vaccine_wave = 0, second_vaccine_wave = 0, vaccine_wave_val = 0)
  
  print(paste0("Percentage of 0-17 years receiving vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "0-17 years"))))
  print(paste0("Percentage of 18-29 years receiving vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "18-29 years"))))
  print(paste0("Percentage of 30-49 years receiving vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "30-49 years"))))
  print(paste0("Percentage of 50-64 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "50-64 years"))))
  print(paste0("Percentage of 65-74 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "65-74 years"))))
  print(paste0("Percentage of 75+ years receiving vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "75+ years"))))

  print(paste0("Percentage of higher risk and immunocompromised receiving second dose: ",  length(which(vax_assignment$risk_group %in% c("higher risk", "immunocompromised") & vax_assignment$vax_2 == 1))/length(which(vax_assignment$risk_group %in% c("higher risk", "immunocompromised")))))
  print(paste0("Percentage of 65-74 years receiving second dose: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$vax_2 == 1))/length(which(vax_assignment$age_group == "65-74 years"))))
  print(paste0("Percentage of 75+ years receiving second dose: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$vax_2 == 1))/length(which(vax_assignment$age_group == "75+ years"))))

  return(vax_assignment %>% arrange(individual))
}

#Strategy 1: Annual vaccine to 6 months and older
strategy_1 <- function(df, first_dose_data, second_dose_data, next_year_dose_data, realistic_ind){
  
  #Assign who is getting vaccinated using age-specific and risk-specific coverage rates
  # NOTE: `vax` and `vax_2` assigns who will get 1st and 2nd boosters based on coverage rates.
  #       `vaccine_wave` and `second_vaccine_wave` assigns when those boosters are administered based on historic uptake
  vax_assignment <- df %>% mutate(vax = 0, vax_2 = 0, vax_val = 0, vaccine_wave = 0, second_vaccine_wave = 0, vaccine_wave_val = 0)
  
  #Pull coverage rates from first and second dose data
  first_dose_coverage <- (first_dose_data %>% filter(week == 52) %>% arrange(age_group, risk_group))$risk_coverage/100
  
  #For 0-17 years age bin, assume that 96.7% of 0-17 years are older than 6 months (CRUDE ASSUMPTION)
  age_0_17_index <- which(vax_assignment$age_group == "0-17 years")
  age_0_17_index <- sample(age_0_17_index, length(age_0_17_index) * 0.967)
  
  age_18_29_index <- which(vax_assignment$age_group == "18-29 years")
  age_30_49_index <- which(vax_assignment$age_group == "30-49 years")
  age_50_64_index <- which(vax_assignment$age_group == "50-64 years")
  age_65_74_index <- which(vax_assignment$age_group == "65-74 years")
  age_75_plus_index <- which(vax_assignment$age_group == "75+ years")
  
  risk_healthy_index <- which(vax_assignment$risk_group == "healthy")
  risk_highrisk_index <- which(vax_assignment$risk_group == "higher risk")
  risk_immuno_index <- which(vax_assignment$risk_group == "immunocompromised")
  
  vaccinated <- which(vax_assignment$prior_vacc != "unvax")
  
  vax_assignment$vax[Reduce(intersect, list(age_0_17_index,risk_healthy_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_0_17_index,risk_healthy_index,vaccinated))), 1, first_dose_coverage[1] * length(Reduce(intersect, list(age_0_17_index,risk_healthy_index)))/length(Reduce(intersect, list(age_0_17_index,risk_healthy_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_0_17_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_0_17_index,risk_highrisk_index,vaccinated))), 1, if_else(first_dose_coverage[2] * length(Reduce(intersect, list(age_0_17_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_0_17_index,risk_highrisk_index,vaccinated))) > 1, 1, first_dose_coverage[2] * length(Reduce(intersect, list(age_0_17_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_0_17_index,risk_highrisk_index,vaccinated)))))
  vax_assignment$vax[Reduce(intersect, list(age_0_17_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_0_17_index,risk_immuno_index,vaccinated))), 1, if_else(first_dose_coverage[3] * length(Reduce(intersect, list(age_0_17_index,risk_immuno_index)))/length(Reduce(intersect, list(age_0_17_index,risk_immuno_index,vaccinated))) > 1, 1, first_dose_coverage[3] * length(Reduce(intersect, list(age_0_17_index,risk_immuno_index)))/length(Reduce(intersect, list(age_0_17_index,risk_immuno_index,vaccinated)))))
  
  vax_assignment$vax[Reduce(intersect, list(age_18_29_index,risk_healthy_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_18_29_index,risk_healthy_index,vaccinated))), 1, first_dose_coverage[4] * length(Reduce(intersect, list(age_18_29_index,risk_healthy_index)))/length(Reduce(intersect, list(age_18_29_index,risk_healthy_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_18_29_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index,vaccinated))), 1, if_else(first_dose_coverage[5] * length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index,vaccinated))) > 1, 1, first_dose_coverage[5] * length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index,vaccinated)))))
  vax_assignment$vax[Reduce(intersect, list(age_18_29_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,vaccinated))), 1, if_else(first_dose_coverage[6] * length(Reduce(intersect, list(age_18_29_index,risk_immuno_index)))/length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,vaccinated))) > 1, 1, first_dose_coverage[6] * length(Reduce(intersect, list(age_18_29_index,risk_immuno_index)))/length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,vaccinated)))))
  
  vax_assignment$vax[Reduce(intersect, list(age_30_49_index,risk_healthy_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_30_49_index,risk_healthy_index,vaccinated))), 1, first_dose_coverage[7] * length(Reduce(intersect, list(age_30_49_index,risk_healthy_index)))/length(Reduce(intersect, list(age_30_49_index,risk_healthy_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_30_49_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index,vaccinated))), 1, if_else(first_dose_coverage[8] * length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index,vaccinated))) > 1, 1, first_dose_coverage[8] * length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index,vaccinated)))))
  vax_assignment$vax[Reduce(intersect, list(age_30_49_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,vaccinated))), 1, if_else(first_dose_coverage[9] * length(Reduce(intersect, list(age_30_49_index,risk_immuno_index)))/length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,vaccinated))) > 1, 1, first_dose_coverage[9] * length(Reduce(intersect, list(age_30_49_index,risk_immuno_index)))/length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,vaccinated)))))
  
  vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_healthy_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_50_64_index,risk_healthy_index,vaccinated))), 1, first_dose_coverage[10] * length(Reduce(intersect, list(age_50_64_index,risk_healthy_index)))/length(Reduce(intersect, list(age_50_64_index,risk_healthy_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index,vaccinated))), 1, first_dose_coverage[11] * length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,vaccinated))), 1, first_dose_coverage[12] * length(Reduce(intersect, list(age_50_64_index,risk_immuno_index)))/length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,vaccinated))))
  
  vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_healthy_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_65_74_index,risk_healthy_index,vaccinated))), 1, first_dose_coverage[13] * length(Reduce(intersect, list(age_65_74_index,risk_healthy_index)))/length(Reduce(intersect, list(age_65_74_index,risk_healthy_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index,vaccinated))), 1, first_dose_coverage[14] * length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_65_74_index,risk_immuno_index,vaccinated))), 1, first_dose_coverage[15] * length(Reduce(intersect, list(age_65_74_index,risk_immuno_index)))/length(Reduce(intersect, list(age_65_74_index,risk_immuno_index,vaccinated))))
  
  vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index,vaccinated))), 1, first_dose_coverage[16] * length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index)))/length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,vaccinated))), 1, first_dose_coverage[17] * length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index,vaccinated))), 1, first_dose_coverage[18] * length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index)))/length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index,vaccinated))))
  
  print(paste0("Percentage of 0-17 years receiving vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$vax == 1))/(length(which(vax_assignment$age_group == "0-17 years"))* 0.967)))
  print(paste0("Percentage of 18-29 years receiving vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "18-29 years"))))
  print(paste0("Percentage of 30-49 years receiving vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "30-49 years"))))
  print(paste0("Percentage of 50-64 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "50-64 years"))))
  print(paste0("Percentage of 65-74 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "65-74 years"))))
  print(paste0("Percentage of 75+ years receiving vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "75+ years"))))
  
  print(paste0("0-17 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy"))* 0.967)))
  print(paste0("18-29 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy"))))
  print(paste0("30-49 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy"))))
  print(paste0("50-64 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy"))))
  print(paste0("65-74 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy"))))
  print(paste0("75+ years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy"))))
  
  print(paste0("0-17 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk"))* 0.967)))
  print(paste0("18-29 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk"))))
  print(paste0("30-49 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk"))))
  print(paste0("50-64 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk"))))
  print(paste0("65-74 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk"))))
  print(paste0("75+ years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk"))))
  
  print(paste0("0-17 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised"))* 0.967)))
  print(paste0("18-29 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised"))))
  print(paste0("30-49 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised"))))
  print(paste0("50-64 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised"))))
  print(paste0("65-74 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised"))))
  print(paste0("75+ years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised"))))
  
  #Assign who is getting the second dose of the updated booster (filter among individuals who have already been assigned with receiving 1 updated booster) 
  print(paste0("Percentage of higher risk and immunocompromised receiving second dose: ",  length(which(vax_assignment$risk_group %in% c("higher risk", "immunocompromised") & vax_assignment$vax_2 == 1))/length(which(vax_assignment$risk_group %in% c("higher risk", "immunocompromised")))))
  print(paste0("Percentage of 65-74 years receiving second dose: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$vax_2 == 1))/length(which(vax_assignment$age_group == "65-74 years"))))
  print(paste0("Percentage of 75+ years receiving second dose: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$vax_2 == 1))/length(which(vax_assignment$age_group == "75+ years"))))
  
  
  #distribute booster uptake over next 365 days, according to age distributions
  to_vaccinate_index <- which(vax_assignment$vax == 1)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_0_17_index,risk_healthy_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_0_17_index,risk_healthy_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "0-17 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "0-17 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_0_17_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_0_17_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "0-17 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "0-17 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_0_17_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_0_17_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "0-17 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "0-17 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_18_29_index,risk_healthy_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_18_29_index,risk_healthy_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "18-29 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "18-29 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_18_29_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "18-29 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "18-29 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_18_29_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "18-29 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "18-29 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_30_49_index,risk_healthy_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_30_49_index,risk_healthy_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_30_49_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_50_64_index,risk_healthy_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_50_64_index,risk_healthy_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_50_64_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "75+ years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "75+ years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "75+ years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "75+ years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "75+ years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "75+ years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  #Assign anyone receiving dose in 2nd year of simulation the same as 1st year (optimistic, pessimistic)
  #Otherwise, assign vax_val to realistic uptake over period
  if(realistic_ind == 1) {
    
    second_dose <- which(vax_assignment$vax == 1)
    #Assign who will receive the updated booster (validation period)
    vax_assignment$vax_val[Reduce(intersect, list(age_0_17_index,risk_healthy_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_0_17_index,risk_healthy_index,second_dose))), 1, 0.1194 * length(Reduce(intersect, list(age_0_17_index,risk_healthy_index)))/length(Reduce(intersect, list(age_0_17_index,risk_healthy_index,second_dose))))
    vax_assignment$vax_val[Reduce(intersect, list(age_0_17_index,risk_highrisk_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_0_17_index,risk_highrisk_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_0_17_index,risk_highrisk_index)), second_dose), round(length(Reduce(intersect, list(age_0_17_index,risk_highrisk_index))) * (0.2397 - 0.235)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_0_17_index,risk_immuno_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_0_17_index,risk_immuno_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_0_17_index,risk_immuno_index)), second_dose), round(length(Reduce(intersect, list(age_0_17_index,risk_immuno_index))) * (0.2397 - 0.235)))] <- 1
    
    vax_assignment$vax_val[Reduce(intersect, list(age_18_29_index,risk_healthy_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_18_29_index,risk_healthy_index,second_dose))), 1, 0.0758 * length(Reduce(intersect, list(age_18_29_index,risk_healthy_index)))/length(Reduce(intersect, list(age_18_29_index,risk_healthy_index,second_dose))))
    vax_assignment$vax_val[Reduce(intersect, list(age_18_29_index,risk_highrisk_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index,second_dose))), 1, 0.1521 * length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index,second_dose))))
    vax_assignment$vax_val[Reduce(intersect, list(age_18_29_index,risk_immuno_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,second_dose))), 1, 0.1521 * length(Reduce(intersect, list(age_18_29_index,risk_immuno_index)))/length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,second_dose))))
    
    vax_assignment$vax_val[Reduce(intersect, list(age_30_49_index,risk_healthy_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_30_49_index,risk_healthy_index,second_dose))), 1, 0.121 * length(Reduce(intersect, list(age_30_49_index,risk_healthy_index)))/length(Reduce(intersect, list(age_30_49_index,risk_healthy_index,second_dose))))
    vax_assignment$vax_val[Reduce(intersect, list(age_30_49_index,risk_highrisk_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_30_49_index,risk_highrisk_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_30_49_index,risk_highrisk_index)), second_dose), round(length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index))) * (0.2428 - 0.2355)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_30_49_index,risk_immuno_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_30_49_index,risk_immuno_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_30_49_index,risk_immuno_index)), second_dose), round(length(Reduce(intersect, list(age_30_49_index,risk_immuno_index))) * (0.2428 - 0.2355)))] <- 1
    
    
    vax_assignment$vax_val[Reduce(intersect, list(age_50_64_index,risk_healthy_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_healthy_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_50_64_index,risk_healthy_index)), second_dose), round(length(Reduce(intersect, list(age_50_64_index,risk_healthy_index))) * (0.1471 - 0.1439)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_50_64_index,risk_highrisk_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_highrisk_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_50_64_index,risk_highrisk_index)), second_dose), round(length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index))) * (0.2953 - 0.2591)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_50_64_index,risk_immuno_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_immuno_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_50_64_index,risk_immuno_index)), second_dose), round(length(Reduce(intersect, list(age_50_64_index,risk_immuno_index))) * (0.2953 - 0.2591)))] <- 1
    
    vax_assignment$vax_val[Reduce(intersect, list(age_65_74_index,risk_healthy_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_healthy_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_65_74_index,risk_healthy_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_65_74_index,risk_healthy_index)), second_dose)) * (0.2334 - 0.2228)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_65_74_index,risk_highrisk_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_65_74_index,risk_highrisk_index)), second_dose)) * (0.4685 - 0.3710)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_65_74_index,risk_immuno_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_immuno_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_65_74_index,risk_immuno_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_65_74_index,risk_immuno_index)), second_dose)) * (0.4685 - 0.3710)))] <- 1
    
    vax_assignment$vax_val[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_75_plus_index,risk_healthy_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_75_plus_index,risk_healthy_index)), second_dose)) * (0.254 - 0.221)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index)), second_dose)) * (0.5097 - 0.3379)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_75_plus_index,risk_immuno_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_75_plus_index,risk_immuno_index)), second_dose)) * (0.5097 - 0.3379)))] <- 1
    
    print(paste0("Percentage of 0-17 years receiving vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years"))* 0.967)))
    print(paste0("Percentage of 18-29 years receiving vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years"))))
    print(paste0("Percentage of 30-49 years receiving vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years"))))
    print(paste0("Percentage of 50-64 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years"))))
    print(paste0("Percentage of 65-74 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years"))))
    print(paste0("Percentage of 75+ years receiving vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years"))))

    print(paste0("0-17 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy")) * 0.967)))
    print(paste0("18-29 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("30-49 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("50-64 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("65-74 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("75+ years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy"))))
    
    print(paste0("0-17 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk"))* 0.967)))
    print(paste0("18-29 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("30-49 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("50-64 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("65-74 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("75+ years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk"))))
    
    print(paste0("0-17 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised"))* 0.967)))
    print(paste0("18-29 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("30-49 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("50-64 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("65-74 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("75+ years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised"))))
    
    #distribute booster uptake over next 182 days, according to age distributions
    to_vaccinate_index <- which(vax_assignment$vax_val == 1)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_0_17_index,risk_healthy_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_0_17_index,risk_healthy_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "0-17 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_0_17_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_0_17_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "0-17 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_0_17_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_0_17_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "0-17 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_18_29_index,risk_healthy_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_18_29_index,risk_healthy_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "18-29 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_18_29_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "18-29 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_18_29_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "18-29 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_30_49_index,risk_healthy_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_30_49_index,risk_healthy_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "30-49 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_30_49_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "30-49 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "30-49 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_50_64_index,risk_healthy_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_50_64_index,risk_healthy_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "50-64 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_50_64_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "50-64 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "50-64 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "65-74 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "65-74 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "65-74 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "75+ years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "75+ years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "75+ years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
  } 
  
  if(realistic_ind == 0){
    print("Optimistic or Pessimistic uptake")
    vax_assignment$vax_val <- vax_assignment$vax
    vax_assignment$vaccine_wave_val <- if_else(vax_assignment$vax_val == 1, vax_assignment$vaccine_wave + 365, 0)
    
    print(paste0("Percentage of 0-17 years receiving vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years"))* 0.967)))
    print(paste0("Percentage of 18-29 years receiving vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years"))))
    print(paste0("Percentage of 30-49 years receiving vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years"))))
    print(paste0("Percentage of 50-64 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years"))))
    print(paste0("Percentage of 65-74 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years"))))
    print(paste0("Percentage of 75+ years receiving vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years"))))

    print(paste0("0-17 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy"))* 0.967)))
    print(paste0("18-29 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("30-49 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("50-64 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("65-74 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("75+ years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy"))))
    
    print(paste0("0-17 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk"))* 0.967)))
    print(paste0("18-29 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("30-49 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("50-64 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("65-74 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("75+ years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk"))))
    
    print(paste0("0-17 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised"))* 0.967)))
    print(paste0("18-29 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("30-49 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("50-64 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("65-74 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("75+ years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised"))))
  }
    
  return(vax_assignment %>% arrange(individual))
}

#Strategy 2: Annual vaccine to 18 years and older
strategy_2 <- function(df, first_dose_data, second_dose_data, next_year_dose_data, realistic_ind){
  
  #Assign who is getting vaccinated using age-specific and risk-specific coverage rates
  # NOTE: `vax` and `vax_2` assigns who will get 1st and 2nd boosters based on coverage rates.
  #       `vaccine_wave` and `second_vaccine_wave` assigns when those boosters are administered based on historic uptake
  vax_assignment <- df %>% mutate(vax = 0, vax_2 = 0, vax_val = 0, vaccine_wave = 0, second_vaccine_wave = 0, vaccine_wave_val = 0)
  
  #Pull coverage rates from first and second dose data
  first_dose_coverage <- (first_dose_data %>% filter(week == 52) %>% arrange(age_group, risk_group))$risk_coverage/100
  
  #For 0-17 years age bin, assume that 96.7% of 0-17 years are older than 6 months (CRUDE ASSUMPTION)
  age_0_17_index <- which(vax_assignment$age_group == "0-17 years")
  age_0_17_index <- sample(age_0_17_index, length(age_0_17_index) * 0.967)
  
  age_18_29_index <- which(vax_assignment$age_group == "18-29 years")
  age_30_49_index <- which(vax_assignment$age_group == "30-49 years")
  age_50_64_index <- which(vax_assignment$age_group == "50-64 years")
  age_65_74_index <- which(vax_assignment$age_group == "65-74 years")
  age_75_plus_index <- which(vax_assignment$age_group == "75+ years")
  
  risk_healthy_index <- which(vax_assignment$risk_group == "healthy")
  risk_highrisk_index <- which(vax_assignment$risk_group == "higher risk")
  risk_immuno_index <- which(vax_assignment$risk_group == "immunocompromised")
  
  vaccinated <- which(vax_assignment$prior_vacc != "unvax")
  
  vax_assignment$vax[Reduce(intersect, list(age_18_29_index,risk_healthy_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_18_29_index,risk_healthy_index,vaccinated))), 1, first_dose_coverage[4] * length(Reduce(intersect, list(age_18_29_index,risk_healthy_index)))/length(Reduce(intersect, list(age_18_29_index,risk_healthy_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_18_29_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index,vaccinated))), 1, if_else(first_dose_coverage[5] * length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index,vaccinated))) > 1, 1, first_dose_coverage[5] * length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index,vaccinated)))))
  vax_assignment$vax[Reduce(intersect, list(age_18_29_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,vaccinated))), 1, if_else(first_dose_coverage[6] * length(Reduce(intersect, list(age_18_29_index,risk_immuno_index)))/length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,vaccinated))) > 1, 1, first_dose_coverage[6] * length(Reduce(intersect, list(age_18_29_index,risk_immuno_index)))/length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,vaccinated)))))
  
  vax_assignment$vax[Reduce(intersect, list(age_30_49_index,risk_healthy_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_30_49_index,risk_healthy_index,vaccinated))), 1, first_dose_coverage[7] * length(Reduce(intersect, list(age_30_49_index,risk_healthy_index)))/length(Reduce(intersect, list(age_30_49_index,risk_healthy_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_30_49_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index,vaccinated))), 1, if_else(first_dose_coverage[8] * length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index,vaccinated))) > 1, 1, first_dose_coverage[8] * length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index,vaccinated)))))
  vax_assignment$vax[Reduce(intersect, list(age_30_49_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,vaccinated))), 1, if_else(first_dose_coverage[9] * length(Reduce(intersect, list(age_30_49_index,risk_immuno_index)))/length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,vaccinated))) > 1, 1, first_dose_coverage[9] * length(Reduce(intersect, list(age_30_49_index,risk_immuno_index)))/length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,vaccinated)))))
  
  vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_healthy_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_50_64_index,risk_healthy_index,vaccinated))), 1, first_dose_coverage[10] * length(Reduce(intersect, list(age_50_64_index,risk_healthy_index)))/length(Reduce(intersect, list(age_50_64_index,risk_healthy_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index,vaccinated))), 1, first_dose_coverage[11] * length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,vaccinated))), 1, first_dose_coverage[12] * length(Reduce(intersect, list(age_50_64_index,risk_immuno_index)))/length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,vaccinated))))
  
  vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_healthy_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_65_74_index,risk_healthy_index,vaccinated))), 1, first_dose_coverage[13] * length(Reduce(intersect, list(age_65_74_index,risk_healthy_index)))/length(Reduce(intersect, list(age_65_74_index,risk_healthy_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index,vaccinated))), 1, first_dose_coverage[14] * length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_65_74_index,risk_immuno_index,vaccinated))), 1, first_dose_coverage[15] * length(Reduce(intersect, list(age_65_74_index,risk_immuno_index)))/length(Reduce(intersect, list(age_65_74_index,risk_immuno_index,vaccinated))))
  
  vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index,vaccinated))), 1, first_dose_coverage[16] * length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index)))/length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,vaccinated))), 1, first_dose_coverage[17] * length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index,vaccinated))), 1, first_dose_coverage[18] * length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index)))/length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index,vaccinated))))
  
  print(paste0("Percentage of 0-17 years receiving vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$vax == 1))/(length(which(vax_assignment$age_group == "0-17 years"))* 0.967)))
  print(paste0("Percentage of 18-29 years receiving vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "18-29 years"))))
  print(paste0("Percentage of 30-49 years receiving vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "30-49 years"))))
  print(paste0("Percentage of 50-64 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "50-64 years"))))
  print(paste0("Percentage of 65-74 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "65-74 years"))))
  print(paste0("Percentage of 75+ years receiving vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "75+ years"))))
  
  print(paste0("0-17 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy"))* 0.967)))
  print(paste0("18-29 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy"))))
  print(paste0("30-49 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy"))))
  print(paste0("50-64 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy"))))
  print(paste0("65-74 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy"))))
  print(paste0("75+ years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy"))))
  
  print(paste0("0-17 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk"))* 0.967)))
  print(paste0("18-29 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk"))))
  print(paste0("30-49 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk"))))
  print(paste0("50-64 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk"))))
  print(paste0("65-74 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk"))))
  print(paste0("75+ years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk"))))
  
  print(paste0("0-17 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised"))* 0.967)))
  print(paste0("18-29 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised"))))
  print(paste0("30-49 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised"))))
  print(paste0("50-64 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised"))))
  print(paste0("65-74 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised"))))
  print(paste0("75+ years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised"))))
  
  #Assign who is getting the second dose of the updated booster (filter among individuals who have already been assigned with receiving 1 updated booster) 
  print(paste0("Percentage of higher risk and immunocompromised receiving second dose: ",  length(which(vax_assignment$risk_group %in% c("higher risk", "immunocompromised") & vax_assignment$vax_2 == 1))/length(which(vax_assignment$risk_group %in% c("higher risk", "immunocompromised")))))
  print(paste0("Percentage of 65-74 years receiving second dose: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$vax_2 == 1))/length(which(vax_assignment$age_group == "65-74 years"))))
  print(paste0("Percentage of 75+ years receiving second dose: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$vax_2 == 1))/length(which(vax_assignment$age_group == "75+ years"))))
  
  
  #distribute booster uptake over next 365 days, according to age distributions
  to_vaccinate_index <- which(vax_assignment$vax == 1)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_18_29_index,risk_healthy_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_18_29_index,risk_healthy_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "18-29 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "18-29 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_18_29_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "18-29 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "18-29 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_18_29_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "18-29 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "18-29 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_30_49_index,risk_healthy_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_30_49_index,risk_healthy_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_30_49_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_50_64_index,risk_healthy_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_50_64_index,risk_healthy_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_50_64_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "75+ years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "75+ years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "75+ years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "75+ years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "75+ years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "75+ years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  #Assign anyone receiving dose in 2nd year of simulation the same as 1st year (optimistic, pessimistic)
  #Otherwise, assign vax_val to realistic uptake over period
  if(realistic_ind == 1) {
    
    second_dose <- which(vax_assignment$vax == 1)
    #Assign who will receive the updated booster (validation period)
    vax_assignment$vax_val[Reduce(intersect, list(age_18_29_index,risk_healthy_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_18_29_index,risk_healthy_index,second_dose))), 1, 0.0758 * length(Reduce(intersect, list(age_18_29_index,risk_healthy_index)))/length(Reduce(intersect, list(age_18_29_index,risk_healthy_index,second_dose))))
    vax_assignment$vax_val[Reduce(intersect, list(age_18_29_index,risk_highrisk_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index,second_dose))), 1, 0.1521 * length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index,second_dose))))
    vax_assignment$vax_val[Reduce(intersect, list(age_18_29_index,risk_immuno_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,second_dose))), 1, 0.1521 * length(Reduce(intersect, list(age_18_29_index,risk_immuno_index)))/length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,second_dose))))
    
    vax_assignment$vax_val[Reduce(intersect, list(age_30_49_index,risk_healthy_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_30_49_index,risk_healthy_index,second_dose))), 1, 0.121 * length(Reduce(intersect, list(age_30_49_index,risk_healthy_index)))/length(Reduce(intersect, list(age_30_49_index,risk_healthy_index,second_dose))))
    vax_assignment$vax_val[Reduce(intersect, list(age_30_49_index,risk_highrisk_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_30_49_index,risk_highrisk_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_30_49_index,risk_highrisk_index)), second_dose), round(length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index))) * (0.2428 - 0.2355)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_30_49_index,risk_immuno_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_30_49_index,risk_immuno_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_30_49_index,risk_immuno_index)), second_dose), round(length(Reduce(intersect, list(age_30_49_index,risk_immuno_index))) * (0.2428 - 0.2355)))] <- 1
    
    vax_assignment$vax_val[Reduce(intersect, list(age_50_64_index,risk_healthy_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_healthy_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_50_64_index,risk_healthy_index)), second_dose), round(length(Reduce(intersect, list(age_50_64_index,risk_healthy_index))) * (0.1471 - 0.1439)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_50_64_index,risk_highrisk_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_highrisk_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_50_64_index,risk_highrisk_index)), second_dose), round(length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index))) * (0.2953 - 0.2591)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_50_64_index,risk_immuno_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_immuno_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_50_64_index,risk_immuno_index)), second_dose), round(length(Reduce(intersect, list(age_50_64_index,risk_immuno_index))) * (0.2953 - 0.2591)))] <- 1
    
    vax_assignment$vax_val[Reduce(intersect, list(age_65_74_index,risk_healthy_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_healthy_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_65_74_index,risk_healthy_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_65_74_index,risk_healthy_index)), second_dose)) * (0.2334 - 0.2228)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_65_74_index,risk_highrisk_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_65_74_index,risk_highrisk_index)), second_dose)) * (0.4685 - 0.3710)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_65_74_index,risk_immuno_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_immuno_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_65_74_index,risk_immuno_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_65_74_index,risk_immuno_index)), second_dose)) * (0.4685 - 0.3710)))] <- 1
    
    vax_assignment$vax_val[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_75_plus_index,risk_healthy_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_75_plus_index,risk_healthy_index)), second_dose)) * (0.254 - 0.221)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index)), second_dose)) * (0.5097 - 0.3379)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_75_plus_index,risk_immuno_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_75_plus_index,risk_immuno_index)), second_dose)) * (0.5097 - 0.3379)))] <- 1
    
    print(paste0("Percentage of 0-17 years receiving vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years"))* 0.967)))
    print(paste0("Percentage of 18-29 years receiving vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years"))))
    print(paste0("Percentage of 30-49 years receiving vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years"))))
    print(paste0("Percentage of 50-64 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years"))))
    print(paste0("Percentage of 65-74 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years"))))
    print(paste0("Percentage of 75+ years receiving vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years"))))
    
    print(paste0("0-17 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy")) * 0.967)))
    print(paste0("18-29 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("30-49 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("50-64 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("65-74 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("75+ years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy"))))
    
    print(paste0("0-17 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk"))* 0.967)))
    print(paste0("18-29 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("30-49 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("50-64 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("65-74 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("75+ years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk"))))
    
    print(paste0("0-17 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised"))* 0.967)))
    print(paste0("18-29 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("30-49 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("50-64 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("65-74 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("75+ years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised"))))
    
    #distribute booster uptake over next 182 days, according to age distributions
    to_vaccinate_index <- which(vax_assignment$vax_val == 1)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_18_29_index,risk_healthy_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_18_29_index,risk_healthy_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "18-29 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_18_29_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "18-29 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_18_29_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "18-29 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_30_49_index,risk_healthy_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_30_49_index,risk_healthy_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "30-49 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_30_49_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "30-49 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "30-49 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_50_64_index,risk_healthy_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_50_64_index,risk_healthy_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "50-64 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_50_64_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "50-64 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "50-64 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "65-74 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "65-74 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "65-74 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "75+ years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "75+ years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "75+ years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
  } 
  
  if(realistic_ind == 0){
    print("Optimistic or Pessimistic uptake")
    vax_assignment$vax_val <- vax_assignment$vax
    vax_assignment$vaccine_wave_val <- if_else(vax_assignment$vax_val == 1, vax_assignment$vaccine_wave + 365, 0)
    
    print(paste0("Percentage of 0-17 years receiving vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years"))* 0.967)))
    print(paste0("Percentage of 18-29 years receiving vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years"))))
    print(paste0("Percentage of 30-49 years receiving vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years"))))
    print(paste0("Percentage of 50-64 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years"))))
    print(paste0("Percentage of 65-74 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years"))))
    print(paste0("Percentage of 75+ years receiving vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years"))))
    
    print(paste0("0-17 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy"))* 0.967)))
    print(paste0("18-29 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("30-49 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("50-64 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("65-74 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("75+ years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy"))))
    
    print(paste0("0-17 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk"))* 0.967)))
    print(paste0("18-29 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("30-49 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("50-64 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("65-74 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("75+ years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk"))))
    
    print(paste0("0-17 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised"))* 0.967)))
    print(paste0("18-29 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("30-49 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("50-64 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("65-74 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("75+ years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised"))))
  }
  
  return(vax_assignment %>% arrange(individual))
}

#Strategy 3: Annual vaccine to 30 years and older
strategy_3 <- function(df, first_dose_data, second_dose_data, next_year_dose_data, realistic_ind){
  
  #Assign who is getting vaccinated using age-specific and risk-specific coverage rates
  # NOTE: `vax` and `vax_2` assigns who will get 1st and 2nd boosters based on coverage rates.
  #       `vaccine_wave` and `second_vaccine_wave` assigns when those boosters are administered based on historic uptake
  vax_assignment <- df %>% mutate(vax = 0, vax_2 = 0, vax_val = 0, vaccine_wave = 0, second_vaccine_wave = 0, vaccine_wave_val = 0)
  
  #Pull coverage rates from first and second dose data
  first_dose_coverage <- (first_dose_data %>% filter(week == 52) %>% arrange(age_group, risk_group))$risk_coverage/100
  
  #For 0-17 years age bin, assume that 96.7% of 0-17 years are older than 6 months (CRUDE ASSUMPTION)
  age_0_17_index <- which(vax_assignment$age_group == "0-17 years")
  age_0_17_index <- sample(age_0_17_index, length(age_0_17_index) * 0.967)
  
  age_18_29_index <- which(vax_assignment$age_group == "18-29 years")
  age_30_49_index <- which(vax_assignment$age_group == "30-49 years")
  age_50_64_index <- which(vax_assignment$age_group == "50-64 years")
  age_65_74_index <- which(vax_assignment$age_group == "65-74 years")
  age_75_plus_index <- which(vax_assignment$age_group == "75+ years")
  
  risk_healthy_index <- which(vax_assignment$risk_group == "healthy")
  risk_highrisk_index <- which(vax_assignment$risk_group == "higher risk")
  risk_immuno_index <- which(vax_assignment$risk_group == "immunocompromised")
  
  vaccinated <- which(vax_assignment$prior_vacc != "unvax")
  
  vax_assignment$vax[Reduce(intersect, list(age_30_49_index,risk_healthy_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_30_49_index,risk_healthy_index,vaccinated))), 1, first_dose_coverage[7] * length(Reduce(intersect, list(age_30_49_index,risk_healthy_index)))/length(Reduce(intersect, list(age_30_49_index,risk_healthy_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_30_49_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index,vaccinated))), 1, if_else(first_dose_coverage[8] * length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index,vaccinated))) > 1, 1, first_dose_coverage[8] * length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index,vaccinated)))))
  vax_assignment$vax[Reduce(intersect, list(age_30_49_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,vaccinated))), 1, if_else(first_dose_coverage[9] * length(Reduce(intersect, list(age_30_49_index,risk_immuno_index)))/length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,vaccinated))) > 1, 1, first_dose_coverage[9] * length(Reduce(intersect, list(age_30_49_index,risk_immuno_index)))/length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,vaccinated)))))
  
  vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_healthy_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_50_64_index,risk_healthy_index,vaccinated))), 1, first_dose_coverage[10] * length(Reduce(intersect, list(age_50_64_index,risk_healthy_index)))/length(Reduce(intersect, list(age_50_64_index,risk_healthy_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index,vaccinated))), 1, first_dose_coverage[11] * length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,vaccinated))), 1, first_dose_coverage[12] * length(Reduce(intersect, list(age_50_64_index,risk_immuno_index)))/length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,vaccinated))))
  
  vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_healthy_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_65_74_index,risk_healthy_index,vaccinated))), 1, first_dose_coverage[13] * length(Reduce(intersect, list(age_65_74_index,risk_healthy_index)))/length(Reduce(intersect, list(age_65_74_index,risk_healthy_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index,vaccinated))), 1, first_dose_coverage[14] * length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_65_74_index,risk_immuno_index,vaccinated))), 1, first_dose_coverage[15] * length(Reduce(intersect, list(age_65_74_index,risk_immuno_index)))/length(Reduce(intersect, list(age_65_74_index,risk_immuno_index,vaccinated))))
  
  vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index,vaccinated))), 1, first_dose_coverage[16] * length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index)))/length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,vaccinated))), 1, first_dose_coverage[17] * length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index,vaccinated))), 1, first_dose_coverage[18] * length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index)))/length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index,vaccinated))))
  
  print(paste0("Percentage of 0-17 years receiving vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$vax == 1))/(length(which(vax_assignment$age_group == "0-17 years"))* 0.967)))
  print(paste0("Percentage of 18-29 years receiving vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "18-29 years"))))
  print(paste0("Percentage of 30-49 years receiving vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "30-49 years"))))
  print(paste0("Percentage of 50-64 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "50-64 years"))))
  print(paste0("Percentage of 65-74 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "65-74 years"))))
  print(paste0("Percentage of 75+ years receiving vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "75+ years"))))
  
  print(paste0("0-17 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy"))* 0.967)))
  print(paste0("18-29 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy"))))
  print(paste0("30-49 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy"))))
  print(paste0("50-64 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy"))))
  print(paste0("65-74 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy"))))
  print(paste0("75+ years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy"))))
  
  print(paste0("0-17 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk"))* 0.967)))
  print(paste0("18-29 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk"))))
  print(paste0("30-49 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk"))))
  print(paste0("50-64 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk"))))
  print(paste0("65-74 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk"))))
  print(paste0("75+ years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk"))))
  
  print(paste0("0-17 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised"))* 0.967)))
  print(paste0("18-29 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised"))))
  print(paste0("30-49 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised"))))
  print(paste0("50-64 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised"))))
  print(paste0("65-74 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised"))))
  print(paste0("75+ years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised"))))
  
  #Assign who is getting the second dose of the updated booster (filter among individuals who have already been assigned with receiving 1 updated booster) 
  print(paste0("Percentage of higher risk and immunocompromised receiving second dose: ",  length(which(vax_assignment$risk_group %in% c("higher risk", "immunocompromised") & vax_assignment$vax_2 == 1))/length(which(vax_assignment$risk_group %in% c("higher risk", "immunocompromised")))))
  print(paste0("Percentage of 65-74 years receiving second dose: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$vax_2 == 1))/length(which(vax_assignment$age_group == "65-74 years"))))
  print(paste0("Percentage of 75+ years receiving second dose: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$vax_2 == 1))/length(which(vax_assignment$age_group == "75+ years"))))
  
  
  #distribute booster uptake over next 365 days, according to age distributions
  to_vaccinate_index <- which(vax_assignment$vax == 1)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_30_49_index,risk_healthy_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_30_49_index,risk_healthy_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_30_49_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_50_64_index,risk_healthy_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_50_64_index,risk_healthy_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_50_64_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "75+ years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "75+ years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "75+ years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "75+ years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "75+ years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "75+ years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  #Assign anyone receiving dose in 2nd year of simulation the same as 1st year (optimistic, pessimistic)
  #Otherwise, assign vax_val to realistic uptake over period
  if(realistic_ind == 1) {
    
    second_dose <- which(vax_assignment$vax == 1)
    #Assign who will receive the updated booster (validation period)
    vax_assignment$vax_val[Reduce(intersect, list(age_30_49_index,risk_healthy_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_30_49_index,risk_healthy_index,second_dose))), 1, 0.121 * length(Reduce(intersect, list(age_30_49_index,risk_healthy_index)))/length(Reduce(intersect, list(age_30_49_index,risk_healthy_index,second_dose))))
    vax_assignment$vax_val[Reduce(intersect, list(age_30_49_index,risk_highrisk_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_30_49_index,risk_highrisk_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_30_49_index,risk_highrisk_index)), second_dose), round(length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index))) * (0.2428 - 0.2355)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_30_49_index,risk_immuno_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_30_49_index,risk_immuno_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_30_49_index,risk_immuno_index)), second_dose), round(length(Reduce(intersect, list(age_30_49_index,risk_immuno_index))) * (0.2428 - 0.2355)))] <- 1
    
    
    vax_assignment$vax_val[Reduce(intersect, list(age_50_64_index,risk_healthy_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_healthy_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_50_64_index,risk_healthy_index)), second_dose), round(length(Reduce(intersect, list(age_50_64_index,risk_healthy_index))) * (0.1471 - 0.1439)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_50_64_index,risk_highrisk_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_highrisk_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_50_64_index,risk_highrisk_index)), second_dose), round(length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index))) * (0.2953 - 0.2591)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_50_64_index,risk_immuno_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_immuno_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_50_64_index,risk_immuno_index)), second_dose), round(length(Reduce(intersect, list(age_50_64_index,risk_immuno_index))) * (0.2953 - 0.2591)))] <- 1
    
    vax_assignment$vax_val[Reduce(intersect, list(age_65_74_index,risk_healthy_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_healthy_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_65_74_index,risk_healthy_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_65_74_index,risk_healthy_index)), second_dose)) * (0.2334 - 0.2228)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_65_74_index,risk_highrisk_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_65_74_index,risk_highrisk_index)), second_dose)) * (0.4685 - 0.3710)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_65_74_index,risk_immuno_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_immuno_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_65_74_index,risk_immuno_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_65_74_index,risk_immuno_index)), second_dose)) * (0.4685 - 0.3710)))] <- 1
    
    vax_assignment$vax_val[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_75_plus_index,risk_healthy_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_75_plus_index,risk_healthy_index)), second_dose)) * (0.254 - 0.221)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index)), second_dose)) * (0.5097 - 0.3379)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_75_plus_index,risk_immuno_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_75_plus_index,risk_immuno_index)), second_dose)) * (0.5097 - 0.3379)))] <- 1
    
    print(paste0("Percentage of 0-17 years receiving vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years"))* 0.967)))
    print(paste0("Percentage of 18-29 years receiving vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years"))))
    print(paste0("Percentage of 30-49 years receiving vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years"))))
    print(paste0("Percentage of 50-64 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years"))))
    print(paste0("Percentage of 65-74 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years"))))
    print(paste0("Percentage of 75+ years receiving vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years"))))
    
    print(paste0("0-17 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy")) * 0.967)))
    print(paste0("18-29 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("30-49 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("50-64 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("65-74 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("75+ years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy"))))
    
    print(paste0("0-17 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk"))* 0.967)))
    print(paste0("18-29 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("30-49 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("50-64 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("65-74 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("75+ years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk"))))
    
    print(paste0("0-17 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised"))* 0.967)))
    print(paste0("18-29 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("30-49 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("50-64 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("65-74 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("75+ years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised"))))
    
    #distribute booster uptake over next 182 days, according to age distributions
    to_vaccinate_index <- which(vax_assignment$vax_val == 1)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_30_49_index,risk_healthy_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_30_49_index,risk_healthy_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "30-49 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_30_49_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "30-49 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "30-49 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_50_64_index,risk_healthy_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_50_64_index,risk_healthy_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "50-64 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_50_64_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "50-64 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "50-64 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "65-74 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "65-74 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "65-74 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "75+ years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "75+ years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "75+ years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
  } 
  
  if(realistic_ind == 0){
    print("Optimistic or Pessimistic uptake")
    vax_assignment$vax_val <- vax_assignment$vax
    vax_assignment$vaccine_wave_val <- if_else(vax_assignment$vax_val == 1, vax_assignment$vaccine_wave + 365, 0)
    
    print(paste0("Percentage of 0-17 years receiving vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years"))* 0.967)))
    print(paste0("Percentage of 18-29 years receiving vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years"))))
    print(paste0("Percentage of 30-49 years receiving vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years"))))
    print(paste0("Percentage of 50-64 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years"))))
    print(paste0("Percentage of 65-74 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years"))))
    print(paste0("Percentage of 75+ years receiving vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years"))))
    
    print(paste0("0-17 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy"))* 0.967)))
    print(paste0("18-29 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("30-49 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("50-64 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("65-74 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("75+ years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy"))))
    
    print(paste0("0-17 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk"))* 0.967)))
    print(paste0("18-29 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("30-49 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("50-64 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("65-74 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("75+ years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk"))))
    
    print(paste0("0-17 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised"))* 0.967)))
    print(paste0("18-29 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("30-49 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("50-64 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("65-74 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("75+ years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised"))))
  }
  
  return(vax_assignment %>% arrange(individual))
}

#Strategy 4: Annual vaccine to 65+ years and those with immunocompromised conditions (Risk-based vaccination: traditional groups)
strategy_4 <- function(df, first_dose_data, second_dose_data, next_year_dose_data, realistic_ind){
  
  #Assign who is getting vaccinated using age-specific and risk-specific coverage rates
  # NOTE: `vax` and `vax_2` assigns who will get 1st and 2nd boosters based on coverage rates.
  #       `vaccine_wave` and `second_vaccine_wave` assigns when those boosters are administered based on historic uptake
  vax_assignment <- df %>% mutate(vax = 0, vax_2 = 0, vax_val = 0, vaccine_wave = 0, second_vaccine_wave = 0, vaccine_wave_val = 0)
  
  #Pull coverage rates from first and second dose data
  first_dose_coverage <- (first_dose_data %>% filter(week == 52) %>% arrange(age_group, risk_group))$risk_coverage/100
  
  #For 0-17 years age bin, assume that 96.7% of 0-17 years are older than 6 months (CRUDE ASSUMPTION)
  age_0_17_index <- which(vax_assignment$age_group == "0-17 years")
  age_0_17_index <- sample(age_0_17_index, length(age_0_17_index) * 0.967)
  
  age_18_29_index <- which(vax_assignment$age_group == "18-29 years")
  age_30_49_index <- which(vax_assignment$age_group == "30-49 years")
  age_50_64_index <- which(vax_assignment$age_group == "50-64 years")
  age_65_74_index <- which(vax_assignment$age_group == "65-74 years")
  age_75_plus_index <- which(vax_assignment$age_group == "75+ years")
  
  risk_healthy_index <- which(vax_assignment$risk_group == "healthy")
  risk_highrisk_index <- which(vax_assignment$risk_group == "higher risk")
  risk_immuno_index <- which(vax_assignment$risk_group == "immunocompromised")
  
  vaccinated <- which(vax_assignment$prior_vacc != "unvax")
  
  vax_assignment$vax[Reduce(intersect, list(age_0_17_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_0_17_index,risk_immuno_index,vaccinated))), 1, if_else(first_dose_coverage[3] * length(Reduce(intersect, list(age_0_17_index,risk_immuno_index)))/length(Reduce(intersect, list(age_0_17_index,risk_immuno_index,vaccinated))) > 1, 1, first_dose_coverage[3] * length(Reduce(intersect, list(age_0_17_index,risk_immuno_index)))/length(Reduce(intersect, list(age_0_17_index,risk_immuno_index,vaccinated)))))
  
  vax_assignment$vax[Reduce(intersect, list(age_18_29_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,vaccinated))), 1, if_else(first_dose_coverage[6] * length(Reduce(intersect, list(age_18_29_index,risk_immuno_index)))/length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,vaccinated))) > 1, 1, first_dose_coverage[6] * length(Reduce(intersect, list(age_18_29_index,risk_immuno_index)))/length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,vaccinated)))))
  
  vax_assignment$vax[Reduce(intersect, list(age_30_49_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,vaccinated))), 1, if_else(first_dose_coverage[9] * length(Reduce(intersect, list(age_30_49_index,risk_immuno_index)))/length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,vaccinated))) > 1, 1, first_dose_coverage[9] * length(Reduce(intersect, list(age_30_49_index,risk_immuno_index)))/length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,vaccinated)))))
  
  vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,vaccinated))), 1, first_dose_coverage[12] * length(Reduce(intersect, list(age_50_64_index,risk_immuno_index)))/length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,vaccinated))))
  
  vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_healthy_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_65_74_index,risk_healthy_index,vaccinated))), 1, first_dose_coverage[13] * length(Reduce(intersect, list(age_65_74_index,risk_healthy_index)))/length(Reduce(intersect, list(age_65_74_index,risk_healthy_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index,vaccinated))), 1, first_dose_coverage[14] * length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_65_74_index,risk_immuno_index,vaccinated))), 1, first_dose_coverage[15] * length(Reduce(intersect, list(age_65_74_index,risk_immuno_index)))/length(Reduce(intersect, list(age_65_74_index,risk_immuno_index,vaccinated))))
  
  vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index,vaccinated))), 1, first_dose_coverage[16] * length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index)))/length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,vaccinated))), 1, first_dose_coverage[17] * length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index,vaccinated))), 1, first_dose_coverage[18] * length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index)))/length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index,vaccinated))))
  
  print(paste0("Percentage of 0-17 years receiving vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$vax == 1))/(length(which(vax_assignment$age_group == "0-17 years"))* 0.967)))
  print(paste0("Percentage of 18-29 years receiving vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "18-29 years"))))
  print(paste0("Percentage of 30-49 years receiving vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "30-49 years"))))
  print(paste0("Percentage of 50-64 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "50-64 years"))))
  print(paste0("Percentage of 65-74 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "65-74 years"))))
  print(paste0("Percentage of 75+ years receiving vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "75+ years"))))
  
  print(paste0("0-17 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy"))* 0.967)))
  print(paste0("18-29 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy"))))
  print(paste0("30-49 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy"))))
  print(paste0("50-64 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy"))))
  print(paste0("65-74 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy"))))
  print(paste0("75+ years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy"))))
  
  print(paste0("0-17 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk"))* 0.967)))
  print(paste0("18-29 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk"))))
  print(paste0("30-49 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk"))))
  print(paste0("50-64 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk"))))
  print(paste0("65-74 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk"))))
  print(paste0("75+ years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk"))))
  
  print(paste0("0-17 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised"))* 0.967)))
  print(paste0("18-29 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised"))))
  print(paste0("30-49 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised"))))
  print(paste0("50-64 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised"))))
  print(paste0("65-74 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised"))))
  print(paste0("75+ years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised"))))
  
  #Assign who is getting the second dose of the updated booster (filter among individuals who have already been assigned with receiving 1 updated booster) 
  print(paste0("Percentage of higher risk and immunocompromised receiving second dose: ",  length(which(vax_assignment$risk_group %in% c("higher risk", "immunocompromised") & vax_assignment$vax_2 == 1))/length(which(vax_assignment$risk_group %in% c("higher risk", "immunocompromised")))))
  print(paste0("Percentage of 65-74 years receiving second dose: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$vax_2 == 1))/length(which(vax_assignment$age_group == "65-74 years"))))
  print(paste0("Percentage of 75+ years receiving second dose: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$vax_2 == 1))/length(which(vax_assignment$age_group == "75+ years"))))
  
  
  #distribute booster uptake over next 365 days, according to age distributions
  to_vaccinate_index <- which(vax_assignment$vax == 1)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_0_17_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_0_17_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "0-17 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "0-17 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_18_29_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "18-29 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "18-29 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "75+ years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "75+ years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "75+ years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "75+ years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "75+ years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "75+ years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  #Assign anyone receiving dose in 2nd year of simulation the same as 1st year (optimistic, pessimistic)
  #Otherwise, assign vax_val to realistic uptake over period
  if(realistic_ind == 1) {
    
    second_dose <- which(vax_assignment$vax == 1)
    #Assign who will receive the updated booster (validation period)
    vax_assignment$vax_val[Reduce(intersect, list(age_0_17_index,risk_immuno_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_0_17_index,risk_immuno_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_0_17_index,risk_immuno_index)), second_dose), round(length(Reduce(intersect, list(age_0_17_index,risk_immuno_index))) * (0.2397 - 0.235)))] <- 1
    
    vax_assignment$vax_val[Reduce(intersect, list(age_18_29_index,risk_immuno_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,second_dose))), 1, 0.1521 * length(Reduce(intersect, list(age_18_29_index,risk_immuno_index)))/length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,second_dose))))
    
    vax_assignment$vax_val[Reduce(intersect, list(age_30_49_index,risk_immuno_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_30_49_index,risk_immuno_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_30_49_index,risk_immuno_index)), second_dose), round(length(Reduce(intersect, list(age_30_49_index,risk_immuno_index))) * (0.2428 - 0.2355)))] <- 1
    
    vax_assignment$vax_val[Reduce(intersect, list(age_50_64_index,risk_immuno_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_immuno_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_50_64_index,risk_immuno_index)), second_dose), round(length(Reduce(intersect, list(age_50_64_index,risk_immuno_index))) * (0.2953 - 0.2591)))] <- 1
    
    vax_assignment$vax_val[Reduce(intersect, list(age_65_74_index,risk_healthy_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_healthy_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_65_74_index,risk_healthy_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_65_74_index,risk_healthy_index)), second_dose)) * (0.2334 - 0.2228)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_65_74_index,risk_highrisk_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_65_74_index,risk_highrisk_index)), second_dose)) * (0.4685 - 0.3710)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_65_74_index,risk_immuno_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_immuno_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_65_74_index,risk_immuno_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_65_74_index,risk_immuno_index)), second_dose)) * (0.4685 - 0.3710)))] <- 1
    
    vax_assignment$vax_val[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_75_plus_index,risk_healthy_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_75_plus_index,risk_healthy_index)), second_dose)) * (0.254 - 0.221)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index)), second_dose)) * (0.5097 - 0.3379)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_75_plus_index,risk_immuno_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_75_plus_index,risk_immuno_index)), second_dose)) * (0.5097 - 0.3379)))] <- 1
    
    print(paste0("Percentage of 0-17 years receiving vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years"))* 0.967)))
    print(paste0("Percentage of 18-29 years receiving vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years"))))
    print(paste0("Percentage of 30-49 years receiving vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years"))))
    print(paste0("Percentage of 50-64 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years"))))
    print(paste0("Percentage of 65-74 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years"))))
    print(paste0("Percentage of 75+ years receiving vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years"))))
    
    print(paste0("0-17 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy")) * 0.967)))
    print(paste0("18-29 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("30-49 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("50-64 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("65-74 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("75+ years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy"))))
    
    print(paste0("0-17 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk"))* 0.967)))
    print(paste0("18-29 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("30-49 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("50-64 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("65-74 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("75+ years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk"))))
    
    print(paste0("0-17 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised"))* 0.967)))
    print(paste0("18-29 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("30-49 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("50-64 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("65-74 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("75+ years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised"))))
    
    #distribute booster uptake over next 182 days, according to age distributions
    to_vaccinate_index <- which(vax_assignment$vax_val == 1)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_0_17_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_0_17_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "0-17 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_18_29_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "18-29 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "30-49 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "50-64 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "65-74 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "65-74 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "65-74 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "75+ years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "75+ years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "75+ years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
  } 
  
  if(realistic_ind == 0){
    print("Optimistic or Pessimistic uptake")
    vax_assignment$vax_val <- vax_assignment$vax
    vax_assignment$vaccine_wave_val <- if_else(vax_assignment$vax_val == 1, vax_assignment$vaccine_wave + 365, 0)
    
    print(paste0("Percentage of 0-17 years receiving vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years"))* 0.967)))
    print(paste0("Percentage of 18-29 years receiving vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years"))))
    print(paste0("Percentage of 30-49 years receiving vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years"))))
    print(paste0("Percentage of 50-64 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years"))))
    print(paste0("Percentage of 65-74 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years"))))
    print(paste0("Percentage of 75+ years receiving vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years"))))
    
    print(paste0("0-17 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy"))* 0.967)))
    print(paste0("18-29 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("30-49 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("50-64 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("65-74 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("75+ years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy"))))
    
    print(paste0("0-17 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk"))* 0.967)))
    print(paste0("18-29 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("30-49 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("50-64 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("65-74 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("75+ years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk"))))
    
    print(paste0("0-17 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised"))* 0.967)))
    print(paste0("18-29 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("30-49 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("50-64 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("65-74 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("75+ years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised"))))
  }
  
  return(vax_assignment %>% arrange(individual))
}

#Strategy 5: Semiannual vaccine to 65+ years and those with immunocompromised conditions (Risk-based vaccination: traditional groups)
strategy_5 <- function(df, first_dose_data, second_dose_data, next_year_dose_data, realistic_ind){
  
  #Assign who is getting vaccinated using age-specific and risk-specific coverage rates
  # NOTE: `vax` and `vax_2` assigns who will get 1st and 2nd boosters based on coverage rates.
  #       `vaccine_wave` and `second_vaccine_wave` assigns when those boosters are administered based on historic uptake
  vax_assignment <- df %>% mutate(vax = 0, vax_2 = 0, vax_val = 0, vaccine_wave = 0, second_vaccine_wave = 0, vaccine_wave_val = 0)
  
  #Pull coverage rates from first and second dose data
  first_dose_coverage <- (first_dose_data %>% filter(week == 52) %>% arrange(age_group, risk_group))$risk_coverage/100
  second_dose_coverage <- (second_dose_data %>% filter(week == 52) %>% arrange(age_group, risk_group))$coverage/100
  
  #For 0-17 years age bin, assume that 96.7% of 0-17 years are older than 6 months (CRUDE ASSUMPTION)
  age_0_17_index <- which(vax_assignment$age_group == "0-17 years")
  age_0_17_index <- sample(age_0_17_index, length(age_0_17_index) * 0.967)
  
  age_18_29_index <- which(vax_assignment$age_group == "18-29 years")
  age_30_49_index <- which(vax_assignment$age_group == "30-49 years")
  age_50_64_index <- which(vax_assignment$age_group == "50-64 years")
  age_65_74_index <- which(vax_assignment$age_group == "65-74 years")
  age_75_plus_index <- which(vax_assignment$age_group == "75+ years")
  
  risk_healthy_index <- which(vax_assignment$risk_group == "healthy")
  risk_highrisk_index <- which(vax_assignment$risk_group == "higher risk")
  risk_immuno_index <- which(vax_assignment$risk_group == "immunocompromised")
  
  vaccinated <- which(vax_assignment$prior_vacc != "unvax")
  
  vax_assignment$vax[Reduce(intersect, list(age_0_17_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_0_17_index,risk_immuno_index,vaccinated))), 1, if_else(first_dose_coverage[3] * length(Reduce(intersect, list(age_0_17_index,risk_immuno_index)))/length(Reduce(intersect, list(age_0_17_index,risk_immuno_index,vaccinated))) > 1, 1, first_dose_coverage[3] * length(Reduce(intersect, list(age_0_17_index,risk_immuno_index)))/length(Reduce(intersect, list(age_0_17_index,risk_immuno_index,vaccinated)))))
  
  vax_assignment$vax[Reduce(intersect, list(age_18_29_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,vaccinated))), 1, if_else(first_dose_coverage[6] * length(Reduce(intersect, list(age_18_29_index,risk_immuno_index)))/length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,vaccinated))) > 1, 1, first_dose_coverage[6] * length(Reduce(intersect, list(age_18_29_index,risk_immuno_index)))/length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,vaccinated)))))
  
  vax_assignment$vax[Reduce(intersect, list(age_30_49_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,vaccinated))), 1, if_else(first_dose_coverage[9] * length(Reduce(intersect, list(age_30_49_index,risk_immuno_index)))/length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,vaccinated))) > 1, 1, first_dose_coverage[9] * length(Reduce(intersect, list(age_30_49_index,risk_immuno_index)))/length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,vaccinated)))))
  
  vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,vaccinated))), 1, first_dose_coverage[12] * length(Reduce(intersect, list(age_50_64_index,risk_immuno_index)))/length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,vaccinated))))
  
  vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_healthy_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_65_74_index,risk_healthy_index,vaccinated))), 1, first_dose_coverage[13] * length(Reduce(intersect, list(age_65_74_index,risk_healthy_index)))/length(Reduce(intersect, list(age_65_74_index,risk_healthy_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index,vaccinated))), 1, first_dose_coverage[14] * length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_65_74_index,risk_immuno_index,vaccinated))), 1, first_dose_coverage[15] * length(Reduce(intersect, list(age_65_74_index,risk_immuno_index)))/length(Reduce(intersect, list(age_65_74_index,risk_immuno_index,vaccinated))))
  
  vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index,vaccinated))), 1, first_dose_coverage[16] * length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index)))/length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,vaccinated))), 1, first_dose_coverage[17] * length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index,vaccinated))), 1, first_dose_coverage[18] * length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index)))/length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index,vaccinated))))
  
  print(paste0("Percentage of 0-17 years receiving vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$vax == 1))/(length(which(vax_assignment$age_group == "0-17 years"))* 0.967)))
  print(paste0("Percentage of 18-29 years receiving vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "18-29 years"))))
  print(paste0("Percentage of 30-49 years receiving vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "30-49 years"))))
  print(paste0("Percentage of 50-64 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "50-64 years"))))
  print(paste0("Percentage of 65-74 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "65-74 years"))))
  print(paste0("Percentage of 75+ years receiving vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "75+ years"))))
  
  print(paste0("0-17 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy"))* 0.967)))
  print(paste0("18-29 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy"))))
  print(paste0("30-49 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy"))))
  print(paste0("50-64 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy"))))
  print(paste0("65-74 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy"))))
  print(paste0("75+ years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy"))))
  
  print(paste0("0-17 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk"))* 0.967)))
  print(paste0("18-29 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk"))))
  print(paste0("30-49 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk"))))
  print(paste0("50-64 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk"))))
  print(paste0("65-74 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk"))))
  print(paste0("75+ years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk"))))
  
  print(paste0("0-17 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised"))* 0.967)))
  print(paste0("18-29 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised"))))
  print(paste0("30-49 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised"))))
  print(paste0("50-64 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised"))))
  print(paste0("65-74 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised"))))
  print(paste0("75+ years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised"))))
  
  #Assign who is getting the second dose of the updated booster (filter among individuals who have already been assigned with receiving 1 updated booster) 
  second_dose <- which(vax_assignment$vax == 1)
  
  vax_assignment$vax_2[Reduce(intersect, list(age_18_29_index,risk_immuno_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,second_dose))), 1, if_else(second_dose_coverage[6] * length(Reduce(intersect, list(age_18_29_index,risk_immuno_index)))/length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,second_dose))) > 1, 1, second_dose_coverage[6] * length(Reduce(intersect, list(age_18_29_index,risk_immuno_index)))/length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,second_dose)))))
  
  vax_assignment$vax_2[Reduce(intersect, list(age_30_49_index,risk_immuno_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,second_dose))), 1, if_else(second_dose_coverage[9] * length(Reduce(intersect, list(age_30_49_index,risk_immuno_index)))/length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,second_dose))) > 1, 1, second_dose_coverage[9] * length(Reduce(intersect, list(age_30_49_index,risk_immuno_index)))/length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,second_dose)))))
  
  vax_assignment$vax_2[Reduce(intersect, list(age_50_64_index,risk_immuno_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,second_dose))), 1, if_else(second_dose_coverage[12] * length(Reduce(intersect, list(age_50_64_index,risk_immuno_index)))/length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,second_dose))) > 1, 1, second_dose_coverage[12] * length(Reduce(intersect, list(age_50_64_index,risk_immuno_index)))/length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,second_dose)))))
  
  vax_assignment$vax_2[Reduce(intersect, list(age_65_74_index, second_dose))] <- rbinom(length(Reduce(intersect, list(age_65_74_index, second_dose))), 1, if_else(second_dose_coverage[13] * length(Reduce(intersect, list(age_65_74_index)))/length(Reduce(intersect, list(age_65_74_index,second_dose))) > 1, 1, second_dose_coverage[13] * length(Reduce(intersect, list(age_65_74_index)))/length(Reduce(intersect, list(age_65_74_index,second_dose)))))
  vax_assignment$vax_2[Reduce(intersect, list(age_75_plus_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_75_plus_index, second_dose))), 1, if_else(second_dose_coverage[16] * length(Reduce(intersect, list(age_75_plus_index)))/length(Reduce(intersect, list(age_75_plus_index,second_dose))) > 1, 1, second_dose_coverage[16] * length(Reduce(intersect, list(age_75_plus_index)))/length(Reduce(intersect, list(age_75_plus_index,second_dose)))))
  
  # print(paste0("Eligible for 2nd dose, 65-74 years: ", length(Reduce(intersect, list(age_65_74_index, second_dose)))))
  # print(paste0("Probability of 2nd dose: ", if_else(second_dose_coverage[13] * length(Reduce(intersect, list(age_65_74_index)))/length(Reduce(intersect, list(age_65_74_index,second_dose))) > 1, 1, second_dose_coverage[13] * length(Reduce(intersect, list(age_65_74_index)))/length(Reduce(intersect, list(age_65_74_index,second_dose))))))
  # print(paste0("Eligible for 2nd dose, 75+ years: ", length(Reduce(intersect, list(age_75_plus_index, second_dose)))))
  # print(paste0("Probability of 2nd dose: ", if_else(second_dose_coverage[16] * length(Reduce(intersect, list(age_75_plus_index)))/length(Reduce(intersect, list(age_75_plus_index,second_dose))) > 1, 1, second_dose_coverage[16] * length(Reduce(intersect, list(age_75_plus_index)))/length(Reduce(intersect, list(age_75_plus_index,second_dose))))))
  # 
  print(paste0("Percentage of immunocompromised receiving second dose: ",  length(which(vax_assignment$risk_group %in% c("immunocompromised") & vax_assignment$vax_2 == 1))/length(which(vax_assignment$risk_group %in% c("immunocompromised")))))
  print(paste0("Percentage of 65-74 years receiving second dose: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$vax_2 == 1))/length(which(vax_assignment$age_group == "65-74 years"))))
  print(paste0("Percentage of 75+ years receiving second dose: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$vax_2 == 1))/length(which(vax_assignment$age_group == "75+ years"))))

  #distribute booster uptake over next 365 days, according to age distributions
  to_vaccinate_index <- which(vax_assignment$vax == 1)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_0_17_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_0_17_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "0-17 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "0-17 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_18_29_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "18-29 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "18-29 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "75+ years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "75+ years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "75+ years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "75+ years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "75+ years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "75+ years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  #distribute second dose booster uptake over next 365 days, according to age distributions
  to_vaccinate_second_index <- which(vax_assignment$vax_2 == 1)
  
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_18_29_index,risk_immuno_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "18-29 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "30-49 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "50-64 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "65-74 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "65-74 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "65-74 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "75+ years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "75+ years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "75+ years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  #Assign anyone receiving dose in 2nd year of simulation the same as 1st year (optimistic, pessimistic)
  #Otherwise, assign vax_val to realistic uptake over period
  if(realistic_ind == 1) {
    
    val_dose <- which(vax_assignment$vax_2 == 1)
    vax_assignment$vax_val[Reduce(intersect, list(age_0_17_index,risk_immuno_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_0_17_index,risk_immuno_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_0_17_index,risk_immuno_index)), second_dose), round(length(Reduce(intersect, list(age_0_17_index,risk_immuno_index))) * (0.2397 - 0.235)))] <- 1
    
    vax_assignment$vax_val[Reduce(intersect, list(age_18_29_index,risk_immuno_index,val_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_18_29_index,risk_immuno_index,val_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_18_29_index,risk_immuno_index, second_dose)), val_dose), round(length(Reduce(intersect, list(age_18_29_index,risk_immuno_index))) * (0.1521 - 0.054)))] <- 1
    
    vax_assignment$vax_val[Reduce(intersect, list(age_30_49_index,risk_immuno_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_30_49_index,risk_immuno_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_30_49_index,risk_immuno_index)), second_dose), round(length(Reduce(intersect, list(age_30_49_index,risk_immuno_index))) * (0.2428 - 0.2355)))] <- 1
    
    vax_assignment$vax_val[Reduce(intersect, list(age_50_64_index,risk_immuno_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_immuno_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_50_64_index,risk_immuno_index)), second_dose), round(length(Reduce(intersect, list(age_50_64_index,risk_immuno_index))) * (0.2953 - 0.2591)))] <- 1
    
    vax_assignment$vax_val[Reduce(intersect, list(age_65_74_index,risk_healthy_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_healthy_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_65_74_index,risk_healthy_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_65_74_index,risk_healthy_index)), second_dose)) * (0.2334 - 0.2228)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_65_74_index,risk_highrisk_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_65_74_index,risk_highrisk_index)), second_dose)) * (0.4685 - 0.3710)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_65_74_index,risk_immuno_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_immuno_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_65_74_index,risk_immuno_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_65_74_index,risk_immuno_index)), second_dose)) * (0.4685 - 0.3710)))] <- 1
    
    vax_assignment$vax_val[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_75_plus_index,risk_healthy_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_75_plus_index,risk_healthy_index)), second_dose)) * (0.254 - 0.221)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index)), second_dose)) * (0.5097 - 0.3379)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_75_plus_index,risk_immuno_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_75_plus_index,risk_immuno_index)), second_dose)) * (0.5097 - 0.3379)))] <- 1
    
    print(paste0("Percentage of 0-17 years receiving vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years"))* 0.967)))
    print(paste0("Percentage of 18-29 years receiving vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years"))))
    print(paste0("Percentage of 30-49 years receiving vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years"))))
    print(paste0("Percentage of 50-64 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years"))))
    print(paste0("Percentage of 65-74 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years"))))
    print(paste0("Percentage of 75+ years receiving vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years"))))
    
    print(paste0("0-17 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy")) * 0.967)))
    print(paste0("18-29 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("30-49 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("50-64 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("65-74 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("75+ years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy"))))
    
    print(paste0("0-17 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk"))* 0.967)))
    print(paste0("18-29 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("30-49 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("50-64 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("65-74 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("75+ years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk"))))
    
    print(paste0("0-17 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised"))* 0.967)))
    print(paste0("18-29 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("30-49 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("50-64 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("65-74 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("75+ years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised"))))
    
    #distribute booster uptake over next 182 days, according to age distributions
    to_vaccinate_index <- which(vax_assignment$vax_val == 1)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_0_17_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_0_17_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "0-17 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_18_29_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "18-29 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "30-49 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "50-64 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "65-74 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "65-74 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "65-74 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "75+ years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "75+ years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "75+ years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
  } 
  
  if(realistic_ind == 0){
    print("Optimistic or Pessimistic uptake")
    vax_assignment$vax_val <- vax_assignment$vax
    vax_assignment$vaccine_wave_val <- if_else(vax_assignment$vax_val == 1, vax_assignment$vaccine_wave + 365, 0)
    
    print(paste0("Percentage of 0-17 years receiving vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years"))* 0.967)))
    print(paste0("Percentage of 18-29 years receiving vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years"))))
    print(paste0("Percentage of 30-49 years receiving vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years"))))
    print(paste0("Percentage of 50-64 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years"))))
    print(paste0("Percentage of 65-74 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years"))))
    print(paste0("Percentage of 75+ years receiving vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years"))))
    
    print(paste0("0-17 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy"))* 0.967)))
    print(paste0("18-29 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("30-49 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("50-64 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("65-74 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("75+ years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy"))))
    
    print(paste0("0-17 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk"))* 0.967)))
    print(paste0("18-29 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("30-49 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("50-64 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("65-74 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("75+ years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk"))))
    
    print(paste0("0-17 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised"))* 0.967)))
    print(paste0("18-29 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("30-49 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("50-64 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("65-74 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("75+ years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised"))))
  }
  
  return(vax_assignment %>% arrange(individual))
}

#Strategy 6: Strategy 4, including 18-64 years with significant co-morbidities (higher risk) - (Risk-based vaccination: expanded groups)
strategy_6 <- function(df, first_dose_data, second_dose_data, next_year_dose_data, realistic_ind){
  
  #Assign who is getting vaccinated using age-specific and risk-specific coverage rates
  # NOTE: `vax` and `vax_2` assigns who will get 1st and 2nd boosters based on coverage rates.
  #       `vaccine_wave` and `second_vaccine_wave` assigns when those boosters are administered based on historic uptake
  vax_assignment <- df %>% mutate(vax = 0, vax_2 = 0, vax_val = 0, vaccine_wave = 0, second_vaccine_wave = 0, vaccine_wave_val = 0)
  
  #Pull coverage rates from first and second dose data
  first_dose_coverage <- (first_dose_data %>% filter(week == 52) %>% arrange(age_group, risk_group))$risk_coverage/100
  
  #For 0-17 years age bin, assume that 96.7% of 0-17 years are older than 6 months (CRUDE ASSUMPTION)
  age_0_17_index <- which(vax_assignment$age_group == "0-17 years")
  age_0_17_index <- sample(age_0_17_index, length(age_0_17_index) * 0.967)
  
  age_18_29_index <- which(vax_assignment$age_group == "18-29 years")
  age_30_49_index <- which(vax_assignment$age_group == "30-49 years")
  age_50_64_index <- which(vax_assignment$age_group == "50-64 years")
  age_65_74_index <- which(vax_assignment$age_group == "65-74 years")
  age_75_plus_index <- which(vax_assignment$age_group == "75+ years")
  
  risk_healthy_index <- which(vax_assignment$risk_group == "healthy")
  risk_highrisk_index <- which(vax_assignment$risk_group == "higher risk")
  risk_immuno_index <- which(vax_assignment$risk_group == "immunocompromised")
  
  vaccinated <- which(vax_assignment$prior_vacc != "unvax")
  
  vax_assignment$vax[Reduce(intersect, list(age_0_17_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_0_17_index,risk_highrisk_index,vaccinated))), 1, if_else(first_dose_coverage[2] * length(Reduce(intersect, list(age_0_17_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_0_17_index,risk_highrisk_index,vaccinated))) > 1, 1, first_dose_coverage[2] * length(Reduce(intersect, list(age_0_17_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_0_17_index,risk_highrisk_index,vaccinated)))))
  vax_assignment$vax[Reduce(intersect, list(age_0_17_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_0_17_index,risk_immuno_index,vaccinated))), 1, if_else(first_dose_coverage[3] * length(Reduce(intersect, list(age_0_17_index,risk_immuno_index)))/length(Reduce(intersect, list(age_0_17_index,risk_immuno_index,vaccinated))) > 1, 1, first_dose_coverage[3] * length(Reduce(intersect, list(age_0_17_index,risk_immuno_index)))/length(Reduce(intersect, list(age_0_17_index,risk_immuno_index,vaccinated)))))
  
  vax_assignment$vax[Reduce(intersect, list(age_18_29_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index,vaccinated))), 1, if_else(first_dose_coverage[5] * length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index,vaccinated))) > 1, 1, first_dose_coverage[5] * length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index,vaccinated)))))
  vax_assignment$vax[Reduce(intersect, list(age_18_29_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,vaccinated))), 1, if_else(first_dose_coverage[6] * length(Reduce(intersect, list(age_18_29_index,risk_immuno_index)))/length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,vaccinated))) > 1, 1, first_dose_coverage[6] * length(Reduce(intersect, list(age_18_29_index,risk_immuno_index)))/length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,vaccinated)))))
  
  vax_assignment$vax[Reduce(intersect, list(age_30_49_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index,vaccinated))), 1, if_else(first_dose_coverage[8] * length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index,vaccinated))) > 1, 1, first_dose_coverage[8] * length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index,vaccinated)))))
  vax_assignment$vax[Reduce(intersect, list(age_30_49_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,vaccinated))), 1, if_else(first_dose_coverage[9] * length(Reduce(intersect, list(age_30_49_index,risk_immuno_index)))/length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,vaccinated))) > 1, 1, first_dose_coverage[9] * length(Reduce(intersect, list(age_30_49_index,risk_immuno_index)))/length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,vaccinated)))))
  
  vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index,vaccinated))), 1, first_dose_coverage[11] * length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,vaccinated))), 1, first_dose_coverage[12] * length(Reduce(intersect, list(age_50_64_index,risk_immuno_index)))/length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,vaccinated))))
  
  vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_healthy_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_65_74_index,risk_healthy_index,vaccinated))), 1, first_dose_coverage[13] * length(Reduce(intersect, list(age_65_74_index,risk_healthy_index)))/length(Reduce(intersect, list(age_65_74_index,risk_healthy_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index,vaccinated))), 1, first_dose_coverage[14] * length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_65_74_index,risk_immuno_index,vaccinated))), 1, first_dose_coverage[15] * length(Reduce(intersect, list(age_65_74_index,risk_immuno_index)))/length(Reduce(intersect, list(age_65_74_index,risk_immuno_index,vaccinated))))
  
  vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index,vaccinated))), 1, first_dose_coverage[16] * length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index)))/length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,vaccinated))), 1, first_dose_coverage[17] * length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index,vaccinated))), 1, first_dose_coverage[18] * length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index)))/length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index,vaccinated))))
  
  print(paste0("Percentage of 0-17 years receiving vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$vax == 1))/(length(which(vax_assignment$age_group == "0-17 years"))* 0.967)))
  print(paste0("Percentage of 18-29 years receiving vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "18-29 years"))))
  print(paste0("Percentage of 30-49 years receiving vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "30-49 years"))))
  print(paste0("Percentage of 50-64 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "50-64 years"))))
  print(paste0("Percentage of 65-74 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "65-74 years"))))
  print(paste0("Percentage of 75+ years receiving vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "75+ years"))))
  
  print(paste0("0-17 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy"))* 0.967)))
  print(paste0("18-29 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy"))))
  print(paste0("30-49 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy"))))
  print(paste0("50-64 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy"))))
  print(paste0("65-74 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy"))))
  print(paste0("75+ years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy"))))
  
  print(paste0("0-17 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk"))* 0.967)))
  print(paste0("18-29 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk"))))
  print(paste0("30-49 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk"))))
  print(paste0("50-64 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk"))))
  print(paste0("65-74 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk"))))
  print(paste0("75+ years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk"))))
  
  print(paste0("0-17 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised"))* 0.967)))
  print(paste0("18-29 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised"))))
  print(paste0("30-49 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised"))))
  print(paste0("50-64 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised"))))
  print(paste0("65-74 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised"))))
  print(paste0("75+ years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised"))))
  
  #Assign who is getting the second dose of the updated booster (filter among individuals who have already been assigned with receiving 1 updated booster) 
  print(paste0("Percentage of higher risk and immunocompromised receiving second dose: ",  length(which(vax_assignment$risk_group %in% c("higher risk", "immunocompromised") & vax_assignment$vax_2 == 1))/length(which(vax_assignment$risk_group %in% c("higher risk", "immunocompromised")))))
  print(paste0("Percentage of 65-74 years receiving second dose: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$vax_2 == 1))/length(which(vax_assignment$age_group == "65-74 years"))))
  print(paste0("Percentage of 75+ years receiving second dose: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$vax_2 == 1))/length(which(vax_assignment$age_group == "75+ years"))))
  
  
  #distribute booster uptake over next 365 days, according to age distributions
  to_vaccinate_index <- which(vax_assignment$vax == 1)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_0_17_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_0_17_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "0-17 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "0-17 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_0_17_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_0_17_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "0-17 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "0-17 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_18_29_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "18-29 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "18-29 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_18_29_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "18-29 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "18-29 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_30_49_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_50_64_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "75+ years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "75+ years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "75+ years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "75+ years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "75+ years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "75+ years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  #Assign anyone receiving dose in 2nd year of simulation the same as 1st year (optimistic, pessimistic)
  #Otherwise, assign vax_val to realistic uptake over period
  if(realistic_ind == 1) {
    
    second_dose <- which(vax_assignment$vax == 1)
    #Assign who will receive the updated booster (validation period)
    vax_assignment$vax_val[Reduce(intersect, list(age_0_17_index,risk_highrisk_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_0_17_index,risk_highrisk_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_0_17_index,risk_highrisk_index)), second_dose), round(length(Reduce(intersect, list(age_0_17_index,risk_highrisk_index))) * (0.2397 - 0.235)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_0_17_index,risk_immuno_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_0_17_index,risk_immuno_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_0_17_index,risk_immuno_index)), second_dose), round(length(Reduce(intersect, list(age_0_17_index,risk_immuno_index))) * (0.2397 - 0.235)))] <- 1
    
    vax_assignment$vax_val[Reduce(intersect, list(age_18_29_index,risk_highrisk_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index,second_dose))), 1, 0.1521 * length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index,second_dose))))
    vax_assignment$vax_val[Reduce(intersect, list(age_18_29_index,risk_immuno_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,second_dose))), 1, 0.1521 * length(Reduce(intersect, list(age_18_29_index,risk_immuno_index)))/length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,second_dose))))
    
    vax_assignment$vax_val[Reduce(intersect, list(age_30_49_index,risk_highrisk_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_30_49_index,risk_highrisk_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_30_49_index,risk_highrisk_index)), second_dose), round(length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index))) * (0.2428 - 0.2355)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_30_49_index,risk_immuno_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_30_49_index,risk_immuno_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_30_49_index,risk_immuno_index)), second_dose), round(length(Reduce(intersect, list(age_30_49_index,risk_immuno_index))) * (0.2428 - 0.2355)))] <- 1
    
    
    vax_assignment$vax_val[Reduce(intersect, list(age_50_64_index,risk_highrisk_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_highrisk_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_50_64_index,risk_highrisk_index)), second_dose), round(length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index))) * (0.2953 - 0.2591)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_50_64_index,risk_immuno_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_immuno_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_50_64_index,risk_immuno_index)), second_dose), round(length(Reduce(intersect, list(age_50_64_index,risk_immuno_index))) * (0.2953 - 0.2591)))] <- 1
    
    vax_assignment$vax_val[Reduce(intersect, list(age_65_74_index,risk_healthy_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_healthy_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_65_74_index,risk_healthy_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_65_74_index,risk_healthy_index)), second_dose)) * (0.2334 - 0.2228)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_65_74_index,risk_highrisk_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_65_74_index,risk_highrisk_index)), second_dose)) * (0.4685 - 0.3710)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_65_74_index,risk_immuno_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_immuno_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_65_74_index,risk_immuno_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_65_74_index,risk_immuno_index)), second_dose)) * (0.4685 - 0.3710)))] <- 1
    
    vax_assignment$vax_val[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_75_plus_index,risk_healthy_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_75_plus_index,risk_healthy_index)), second_dose)) * (0.254 - 0.221)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index)), second_dose)) * (0.5097 - 0.3379)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_75_plus_index,risk_immuno_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_75_plus_index,risk_immuno_index)), second_dose)) * (0.5097 - 0.3379)))] <- 1
    
    print(paste0("Percentage of 0-17 years receiving vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years"))* 0.967)))
    print(paste0("Percentage of 18-29 years receiving vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years"))))
    print(paste0("Percentage of 30-49 years receiving vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years"))))
    print(paste0("Percentage of 50-64 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years"))))
    print(paste0("Percentage of 65-74 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years"))))
    print(paste0("Percentage of 75+ years receiving vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years"))))
    
    print(paste0("0-17 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy")) * 0.967)))
    print(paste0("18-29 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("30-49 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("50-64 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("65-74 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("75+ years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy"))))
    
    print(paste0("0-17 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk"))* 0.967)))
    print(paste0("18-29 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("30-49 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("50-64 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("65-74 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("75+ years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk"))))
    
    print(paste0("0-17 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised"))* 0.967)))
    print(paste0("18-29 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("30-49 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("50-64 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("65-74 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("75+ years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised"))))
    
    #distribute booster uptake over next 182 days, according to age distributions
    to_vaccinate_index <- which(vax_assignment$vax_val == 1)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_0_17_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_0_17_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "0-17 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_0_17_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_0_17_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "0-17 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_18_29_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "18-29 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_18_29_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "18-29 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_30_49_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "30-49 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "30-49 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_50_64_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "50-64 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "50-64 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "65-74 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "65-74 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "65-74 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "75+ years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "75+ years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "75+ years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
  } 
  
  if(realistic_ind == 0){
    print("Optimistic or Pessimistic uptake")
    vax_assignment$vax_val <- vax_assignment$vax
    vax_assignment$vaccine_wave_val <- if_else(vax_assignment$vax_val == 1, vax_assignment$vaccine_wave + 365, 0)
    
    print(paste0("Percentage of 0-17 years receiving vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years"))* 0.967)))
    print(paste0("Percentage of 18-29 years receiving vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years"))))
    print(paste0("Percentage of 30-49 years receiving vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years"))))
    print(paste0("Percentage of 50-64 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years"))))
    print(paste0("Percentage of 65-74 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years"))))
    print(paste0("Percentage of 75+ years receiving vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years"))))
    
    print(paste0("0-17 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy"))* 0.967)))
    print(paste0("18-29 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("30-49 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("50-64 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("65-74 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("75+ years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy"))))
    
    print(paste0("0-17 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk"))* 0.967)))
    print(paste0("18-29 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("30-49 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("50-64 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("65-74 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("75+ years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk"))))
    
    print(paste0("0-17 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised"))* 0.967)))
    print(paste0("18-29 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("30-49 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("50-64 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("65-74 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("75+ years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised"))))
  }
  
  return(vax_assignment %>% arrange(individual))
}

#Strategy 7: Strategy 5, including 18-64 years with significant co-morbidities (higher risk) - (Risk-based vaccination: expanded groups)
strategy_7 <- function(df, first_dose_data, second_dose_data, next_year_dose_data, realistic_ind){
  
  #Assign who is getting vaccinated using age-specific and risk-specific coverage rates
  # NOTE: `vax` and `vax_2` assigns who will get 1st and 2nd boosters based on coverage rates.
  #       `vaccine_wave` and `second_vaccine_wave` assigns when those boosters are administered based on historic uptake
  vax_assignment <- df %>% mutate(vax = 0, vax_2 = 0, vax_val = 0, vaccine_wave = 0, second_vaccine_wave = 0, vaccine_wave_val = 0)
  
  #Pull coverage rates from first and second dose data
  first_dose_coverage <- (first_dose_data %>% filter(week == 52) %>% arrange(age_group, risk_group))$risk_coverage/100
  second_dose_coverage <- (second_dose_data %>% filter(week == 52) %>% arrange(age_group, risk_group))$coverage/100
  
  #For 0-17 years age bin, assume that 96.7% of 0-17 years are older than 6 months (CRUDE ASSUMPTION)
  age_0_17_index <- which(vax_assignment$age_group == "0-17 years")
  age_0_17_index <- sample(age_0_17_index, length(age_0_17_index) * 0.967)
  
  age_18_29_index <- which(vax_assignment$age_group == "18-29 years")
  age_30_49_index <- which(vax_assignment$age_group == "30-49 years")
  age_50_64_index <- which(vax_assignment$age_group == "50-64 years")
  age_65_74_index <- which(vax_assignment$age_group == "65-74 years")
  age_75_plus_index <- which(vax_assignment$age_group == "75+ years")
  
  risk_healthy_index <- which(vax_assignment$risk_group == "healthy")
  risk_highrisk_index <- which(vax_assignment$risk_group == "higher risk")
  risk_immuno_index <- which(vax_assignment$risk_group == "immunocompromised")
  
  vaccinated <- which(vax_assignment$prior_vacc != "unvax")
  
  vax_assignment$vax[Reduce(intersect, list(age_0_17_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_0_17_index,risk_highrisk_index,vaccinated))), 1, if_else(first_dose_coverage[2] * length(Reduce(intersect, list(age_0_17_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_0_17_index,risk_highrisk_index,vaccinated))) > 1, 1, first_dose_coverage[2] * length(Reduce(intersect, list(age_0_17_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_0_17_index,risk_highrisk_index,vaccinated)))))
  vax_assignment$vax[Reduce(intersect, list(age_0_17_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_0_17_index,risk_immuno_index,vaccinated))), 1, if_else(first_dose_coverage[3] * length(Reduce(intersect, list(age_0_17_index,risk_immuno_index)))/length(Reduce(intersect, list(age_0_17_index,risk_immuno_index,vaccinated))) > 1, 1, first_dose_coverage[3] * length(Reduce(intersect, list(age_0_17_index,risk_immuno_index)))/length(Reduce(intersect, list(age_0_17_index,risk_immuno_index,vaccinated)))))
  
  vax_assignment$vax[Reduce(intersect, list(age_18_29_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index,vaccinated))), 1, if_else(first_dose_coverage[5] * length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index,vaccinated))) > 1, 1, first_dose_coverage[5] * length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index,vaccinated)))))
  vax_assignment$vax[Reduce(intersect, list(age_18_29_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,vaccinated))), 1, if_else(first_dose_coverage[6] * length(Reduce(intersect, list(age_18_29_index,risk_immuno_index)))/length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,vaccinated))) > 1, 1, first_dose_coverage[6] * length(Reduce(intersect, list(age_18_29_index,risk_immuno_index)))/length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,vaccinated)))))
  
  vax_assignment$vax[Reduce(intersect, list(age_30_49_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index,vaccinated))), 1, if_else(first_dose_coverage[8] * length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index,vaccinated))) > 1, 1, first_dose_coverage[8] * length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index,vaccinated)))))
  vax_assignment$vax[Reduce(intersect, list(age_30_49_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,vaccinated))), 1, if_else(first_dose_coverage[9] * length(Reduce(intersect, list(age_30_49_index,risk_immuno_index)))/length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,vaccinated))) > 1, 1, first_dose_coverage[9] * length(Reduce(intersect, list(age_30_49_index,risk_immuno_index)))/length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,vaccinated)))))
  
  vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index,vaccinated))), 1, first_dose_coverage[11] * length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,vaccinated))), 1, first_dose_coverage[12] * length(Reduce(intersect, list(age_50_64_index,risk_immuno_index)))/length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,vaccinated))))
  
  vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_healthy_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_65_74_index,risk_healthy_index,vaccinated))), 1, first_dose_coverage[13] * length(Reduce(intersect, list(age_65_74_index,risk_healthy_index)))/length(Reduce(intersect, list(age_65_74_index,risk_healthy_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index,vaccinated))), 1, first_dose_coverage[14] * length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_65_74_index,risk_immuno_index,vaccinated))), 1, first_dose_coverage[15] * length(Reduce(intersect, list(age_65_74_index,risk_immuno_index)))/length(Reduce(intersect, list(age_65_74_index,risk_immuno_index,vaccinated))))
  
  vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index,vaccinated))), 1, first_dose_coverage[16] * length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index)))/length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,vaccinated))), 1, first_dose_coverage[17] * length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index,vaccinated))), 1, first_dose_coverage[18] * length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index)))/length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index,vaccinated))))
  
  print(paste0("Percentage of 0-17 years receiving vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$vax == 1))/(length(which(vax_assignment$age_group == "0-17 years"))* 0.967)))
  print(paste0("Percentage of 18-29 years receiving vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "18-29 years"))))
  print(paste0("Percentage of 30-49 years receiving vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "30-49 years"))))
  print(paste0("Percentage of 50-64 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "50-64 years"))))
  print(paste0("Percentage of 65-74 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "65-74 years"))))
  print(paste0("Percentage of 75+ years receiving vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "75+ years"))))
  
  print(paste0("0-17 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy"))* 0.967)))
  print(paste0("18-29 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy"))))
  print(paste0("30-49 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy"))))
  print(paste0("50-64 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy"))))
  print(paste0("65-74 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy"))))
  print(paste0("75+ years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy"))))
  
  print(paste0("0-17 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk"))* 0.967)))
  print(paste0("18-29 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk"))))
  print(paste0("30-49 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk"))))
  print(paste0("50-64 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk"))))
  print(paste0("65-74 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk"))))
  print(paste0("75+ years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk"))))
  
  print(paste0("0-17 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised"))* 0.967)))
  print(paste0("18-29 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised"))))
  print(paste0("30-49 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised"))))
  print(paste0("50-64 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised"))))
  print(paste0("65-74 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised"))))
  print(paste0("75+ years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised"))))
  
  #Assign who is getting the second dose of the updated booster (filter among individuals who have already been assigned with receiving 1 updated booster) 
  second_dose <- which(vax_assignment$vax == 1)
  
  vax_assignment$vax_2[Reduce(intersect, list(age_18_29_index,risk_highrisk_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index,second_dose))), 1, if_else(second_dose_coverage[5] * length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index,second_dose))) > 1, 1, second_dose_coverage[5] * length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index,second_dose)))))
  vax_assignment$vax_2[Reduce(intersect, list(age_18_29_index,risk_immuno_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,second_dose))), 1, if_else(second_dose_coverage[6] * length(Reduce(intersect, list(age_18_29_index,risk_immuno_index)))/length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,second_dose))) > 1, 1, second_dose_coverage[6] * length(Reduce(intersect, list(age_18_29_index,risk_immuno_index)))/length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,second_dose)))))
  
  vax_assignment$vax_2[Reduce(intersect, list(age_30_49_index,risk_highrisk_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index,second_dose))), 1, if_else(second_dose_coverage[8] * length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index,second_dose))) > 1, 1, second_dose_coverage[8] * length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index,second_dose)))))
  vax_assignment$vax_2[Reduce(intersect, list(age_30_49_index,risk_immuno_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,second_dose))), 1, if_else(second_dose_coverage[9] * length(Reduce(intersect, list(age_30_49_index,risk_immuno_index)))/length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,second_dose))) > 1, 1, second_dose_coverage[9] * length(Reduce(intersect, list(age_30_49_index,risk_immuno_index)))/length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,second_dose)))))
  
  vax_assignment$vax_2[Reduce(intersect, list(age_50_64_index,risk_highrisk_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index,second_dose))), 1, if_else(second_dose_coverage[11] * length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index,second_dose))) > 1, 1, second_dose_coverage[11] * length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index,second_dose)))))
  vax_assignment$vax_2[Reduce(intersect, list(age_50_64_index,risk_immuno_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,second_dose))), 1, if_else(second_dose_coverage[12] * length(Reduce(intersect, list(age_50_64_index,risk_immuno_index)))/length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,second_dose))) > 1, 1, second_dose_coverage[12] * length(Reduce(intersect, list(age_50_64_index,risk_immuno_index)))/length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,second_dose)))))

  vax_assignment$vax_2[Reduce(intersect, list(age_65_74_index, second_dose))] <- rbinom(length(Reduce(intersect, list(age_65_74_index, second_dose))), 1, if_else(second_dose_coverage[13] * length(Reduce(intersect, list(age_65_74_index)))/length(Reduce(intersect, list(age_65_74_index,second_dose))) > 1, 1, second_dose_coverage[13] * length(Reduce(intersect, list(age_65_74_index)))/length(Reduce(intersect, list(age_65_74_index,second_dose)))))
  vax_assignment$vax_2[Reduce(intersect, list(age_75_plus_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_75_plus_index, second_dose))), 1, if_else(second_dose_coverage[16] * length(Reduce(intersect, list(age_75_plus_index)))/length(Reduce(intersect, list(age_75_plus_index,second_dose))) > 1, 1, second_dose_coverage[16] * length(Reduce(intersect, list(age_75_plus_index)))/length(Reduce(intersect, list(age_75_plus_index,second_dose)))))
  
  print(paste0("Percentage of higher risk and immunocompromised receiving second dose: ",  length(which(vax_assignment$risk_group %in% c("higher risk", "immunocompromised") & vax_assignment$vax_2 == 1))/length(which(vax_assignment$risk_group %in% c("higher risk", "immunocompromised")))))
  print(paste0("Percentage of 65-74 years receiving second dose: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$vax_2 == 1))/length(which(vax_assignment$age_group == "65-74 years"))))
  print(paste0("Percentage of 75+ years receiving second dose: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$vax_2 == 1))/length(which(vax_assignment$age_group == "75+ years"))))
  
  #distribute booster uptake over next 365 days, according to age distributions
  to_vaccinate_index <- which(vax_assignment$vax == 1)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_0_17_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_0_17_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "0-17 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "0-17 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_0_17_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_0_17_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "0-17 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "0-17 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_18_29_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "18-29 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "18-29 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_18_29_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "18-29 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "18-29 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_30_49_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_50_64_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "75+ years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "75+ years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "75+ years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "75+ years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "75+ years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "75+ years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  #distribute second dose booster uptake over next 365 days, according to age distributions
  to_vaccinate_second_index <- which(vax_assignment$vax_2 == 1)
  
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_18_29_index,risk_highrisk_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "18-29 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_18_29_index,risk_immuno_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "18-29 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_30_49_index,risk_highrisk_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "30-49 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "30-49 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_50_64_index,risk_highrisk_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "50-64 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "50-64 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "65-74 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "65-74 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "65-74 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "75+ years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "75+ years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "75+ years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  
  #Assign anyone receiving dose in 2nd year of simulation the same as 1st year (optimistic, pessimistic)
  #Otherwise, assign vax_val to realistic uptake over period
  if(realistic_ind == 1) {
    val_dose <- which(vax_assignment$vax_2 == 1)
    
    #Assign who will receive the updated booster (validation period)
    vax_assignment$vax_val[Reduce(intersect, list(age_0_17_index,risk_highrisk_index,second_dose))] <- vax_assignment$vax[Reduce(intersect, list(age_0_17_index,risk_highrisk_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_0_17_index,risk_highrisk_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_0_17_index,risk_highrisk_index)), second_dose)) * (0.2397 - 0.235)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_0_17_index,risk_immuno_index,second_dose))] <- vax_assignment$vax[Reduce(intersect, list(age_0_17_index,risk_immuno_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_0_17_index,risk_immuno_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_0_17_index,risk_immuno_index)), second_dose)) * (0.2397 - 0.235)))] <- 1
    
    vax_assignment$vax_val[Reduce(intersect, list(age_18_29_index,risk_highrisk_index,val_dose))] <- vax_assignment$vax[Reduce(intersect, list(age_18_29_index,risk_highrisk_index,val_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_18_29_index,risk_highrisk_index, second_dose)), val_dose), round(length(setdiff(Reduce(intersect, list(age_18_29_index,risk_highrisk_index, second_dose)), val_dose)) * (0.1521 * 3)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_18_29_index,risk_immuno_index,val_dose))] <- vax_assignment$vax[Reduce(intersect, list(age_18_29_index,risk_immuno_index,val_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_18_29_index,risk_immuno_index, second_dose)), val_dose), round(length(setdiff(Reduce(intersect, list(age_18_29_index,risk_immuno_index, second_dose)), val_dose)) * (0.1521 * 3.5)))] <- 1
    
    vax_assignment$vax_val[Reduce(intersect, list(age_30_49_index,risk_highrisk_index,second_dose))] <- vax_assignment$vax[Reduce(intersect, list(age_30_49_index,risk_highrisk_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_30_49_index,risk_highrisk_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_30_49_index,risk_highrisk_index)), second_dose)) * (0.2428 - 0.2355)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_30_49_index,risk_immuno_index,second_dose))] <- vax_assignment$vax[Reduce(intersect, list(age_30_49_index,risk_immuno_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_30_49_index,risk_immuno_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_30_49_index,risk_immuno_index)), second_dose)) * (0.2428 - 0.2355)))] <- 1
    
    vax_assignment$vax_val[Reduce(intersect, list(age_50_64_index,risk_highrisk_index,second_dose))] <- vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_highrisk_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_50_64_index,risk_highrisk_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_50_64_index,risk_highrisk_index)), second_dose)) * (0.2953 - 0.2591)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_50_64_index,risk_immuno_index,second_dose))] <- vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_immuno_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_50_64_index,risk_immuno_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_50_64_index,risk_immuno_index)), second_dose)) * (0.2953 - 0.2591)))] <- 1
    
    vax_assignment$vax_val[Reduce(intersect, list(age_65_74_index,risk_healthy_index,second_dose))] <- vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_healthy_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_65_74_index,risk_healthy_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_65_74_index,risk_healthy_index)), second_dose)) * (0.2334 - 0.2228)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,second_dose))] <- vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_65_74_index,risk_highrisk_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_65_74_index,risk_highrisk_index)), second_dose)) * (0.4685 - 0.3710)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_65_74_index,risk_immuno_index,second_dose))] <- vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_immuno_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_65_74_index,risk_immuno_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_65_74_index,risk_immuno_index)), second_dose)) * (0.4685 - 0.3710)))] <- 1
    
    vax_assignment$vax_val[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,second_dose))] <- vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_75_plus_index,risk_healthy_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_75_plus_index,risk_healthy_index)), second_dose)) * (0.254 - 0.221)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,second_dose))] <- vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index)), second_dose)) * (0.5097 - 0.3379)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,second_dose))] <- vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_75_plus_index,risk_immuno_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_75_plus_index,risk_immuno_index)), second_dose)) * (0.5097 - 0.3379)))] <- 1
    
    print(paste0("Percentage of 0-17 years receiving vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years"))* 0.967)))
    print(paste0("Percentage of 18-29 years receiving vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years"))))
    print(paste0("Percentage of 30-49 years receiving vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years"))))
    print(paste0("Percentage of 50-64 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years"))))
    print(paste0("Percentage of 65-74 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years"))))
    print(paste0("Percentage of 75+ years receiving vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years"))))
    
    print(paste0("0-17 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy")) * 0.967)))
    print(paste0("18-29 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("30-49 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("50-64 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("65-74 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("75+ years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy"))))
    
    print(paste0("0-17 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk"))* 0.967)))
    print(paste0("18-29 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("30-49 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("50-64 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("65-74 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("75+ years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk"))))
    
    print(paste0("0-17 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised"))* 0.967)))
    print(paste0("18-29 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("30-49 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("50-64 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("65-74 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("75+ years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised"))))
    
    #distribute booster uptake over next 182 days, according to age distributions
    to_vaccinate_index <- which(vax_assignment$vax_val == 1)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_0_17_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_0_17_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "0-17 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_0_17_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_0_17_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "0-17 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_18_29_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "18-29 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_18_29_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "18-29 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_30_49_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "30-49 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "30-49 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_50_64_index,risk_healthy_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_50_64_index,risk_healthy_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "50-64 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_50_64_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "50-64 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "50-64 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "65-74 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "65-74 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "65-74 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "75+ years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "75+ years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "75+ years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
  } 
  
  if(realistic_ind == 0){
    print("Optimistic or Pessimistic uptake")
    vax_assignment$vax_val <- vax_assignment$vax
    vax_assignment$vaccine_wave_val <- if_else(vax_assignment$vax_val == 1, vax_assignment$vaccine_wave + 365, 0)
    
    print(paste0("Percentage of 0-17 years receiving vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years"))* 0.967)))
    print(paste0("Percentage of 18-29 years receiving vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years"))))
    print(paste0("Percentage of 30-49 years receiving vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years"))))
    print(paste0("Percentage of 50-64 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years"))))
    print(paste0("Percentage of 65-74 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years"))))
    print(paste0("Percentage of 75+ years receiving vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years"))))
    
    print(paste0("0-17 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy"))* 0.967)))
    print(paste0("18-29 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("30-49 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("50-64 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("65-74 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("75+ years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy"))))
    
    print(paste0("0-17 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk"))* 0.967)))
    print(paste0("18-29 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("30-49 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("50-64 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("65-74 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("75+ years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk"))))
    
    print(paste0("0-17 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised"))* 0.967)))
    print(paste0("18-29 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("30-49 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("50-64 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("65-74 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("75+ years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised"))))
  }
  
  return(vax_assignment %>% arrange(individual))
}

#Strategy 8: Universal (Strategy 1) with second dose in key risk group (Strategy 5) - (Hybrid)
strategy_8 <- function(df, first_dose_data, second_dose_data, next_year_dose_data, realistic_ind){
  
  #Assign who is getting vaccinated using age-specific and risk-specific coverage rates
  # NOTE: `vax` and `vax_2` assigns who will get 1st and 2nd boosters based on coverage rates.
  #       `vaccine_wave` and `second_vaccine_wave` assigns when those boosters are administered based on historic uptake
  vax_assignment <- df %>% mutate(vax = 0, vax_2 = 0, vax_val = 0, vaccine_wave = 0, second_vaccine_wave = 0, vaccine_wave_val = 0)
  
  #Pull coverage rates from first and second dose data
  first_dose_coverage <- (first_dose_data %>% filter(week == 52) %>% arrange(age_group, risk_group))$risk_coverage/100
  second_dose_coverage <- (second_dose_data %>% filter(week == 52) %>% arrange(age_group, risk_group))$coverage/100
  
  #For 0-17 years age bin, assume that 96.7% of 0-17 years are older than 6 months (CRUDE ASSUMPTION)
  age_0_17_index <- which(vax_assignment$age_group == "0-17 years")
  age_0_17_index <- sample(age_0_17_index, length(age_0_17_index) * 0.967)
  
  age_18_29_index <- which(vax_assignment$age_group == "18-29 years")
  age_30_49_index <- which(vax_assignment$age_group == "30-49 years")
  age_50_64_index <- which(vax_assignment$age_group == "50-64 years")
  age_65_74_index <- which(vax_assignment$age_group == "65-74 years")
  age_75_plus_index <- which(vax_assignment$age_group == "75+ years")
  
  risk_healthy_index <- which(vax_assignment$risk_group == "healthy")
  risk_highrisk_index <- which(vax_assignment$risk_group == "higher risk")
  risk_immuno_index <- which(vax_assignment$risk_group == "immunocompromised")
  
  vaccinated <- which(vax_assignment$prior_vacc != "unvax")
  
  vax_assignment$vax[Reduce(intersect, list(age_0_17_index,risk_healthy_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_0_17_index,risk_healthy_index,vaccinated))), 1, first_dose_coverage[1] * length(Reduce(intersect, list(age_0_17_index,risk_healthy_index)))/length(Reduce(intersect, list(age_0_17_index,risk_healthy_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_0_17_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_0_17_index,risk_highrisk_index,vaccinated))), 1, if_else(first_dose_coverage[2] * length(Reduce(intersect, list(age_0_17_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_0_17_index,risk_highrisk_index,vaccinated))) > 1, 1, first_dose_coverage[2] * length(Reduce(intersect, list(age_0_17_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_0_17_index,risk_highrisk_index,vaccinated)))))
  vax_assignment$vax[Reduce(intersect, list(age_0_17_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_0_17_index,risk_immuno_index,vaccinated))), 1, if_else(first_dose_coverage[3] * length(Reduce(intersect, list(age_0_17_index,risk_immuno_index)))/length(Reduce(intersect, list(age_0_17_index,risk_immuno_index,vaccinated))) > 1, 1, first_dose_coverage[3] * length(Reduce(intersect, list(age_0_17_index,risk_immuno_index)))/length(Reduce(intersect, list(age_0_17_index,risk_immuno_index,vaccinated)))))
  
  vax_assignment$vax[Reduce(intersect, list(age_18_29_index,risk_healthy_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_18_29_index,risk_healthy_index,vaccinated))), 1, first_dose_coverage[4] * length(Reduce(intersect, list(age_18_29_index,risk_healthy_index)))/length(Reduce(intersect, list(age_18_29_index,risk_healthy_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_18_29_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index,vaccinated))), 1, if_else(first_dose_coverage[5] * length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index,vaccinated))) > 1, 1, first_dose_coverage[5] * length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index,vaccinated)))))
  vax_assignment$vax[Reduce(intersect, list(age_18_29_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,vaccinated))), 1, if_else(first_dose_coverage[6] * length(Reduce(intersect, list(age_18_29_index,risk_immuno_index)))/length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,vaccinated))) > 1, 1, first_dose_coverage[6] * length(Reduce(intersect, list(age_18_29_index,risk_immuno_index)))/length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,vaccinated)))))
  
  vax_assignment$vax[Reduce(intersect, list(age_30_49_index,risk_healthy_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_30_49_index,risk_healthy_index,vaccinated))), 1, first_dose_coverage[7] * length(Reduce(intersect, list(age_30_49_index,risk_healthy_index)))/length(Reduce(intersect, list(age_30_49_index,risk_healthy_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_30_49_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index,vaccinated))), 1, if_else(first_dose_coverage[8] * length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index,vaccinated))) > 1, 1, first_dose_coverage[8] * length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index,vaccinated)))))
  vax_assignment$vax[Reduce(intersect, list(age_30_49_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,vaccinated))), 1, if_else(first_dose_coverage[9] * length(Reduce(intersect, list(age_30_49_index,risk_immuno_index)))/length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,vaccinated))) > 1, 1, first_dose_coverage[9] * length(Reduce(intersect, list(age_30_49_index,risk_immuno_index)))/length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,vaccinated)))))
  
  vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_healthy_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_50_64_index,risk_healthy_index,vaccinated))), 1, first_dose_coverage[10] * length(Reduce(intersect, list(age_50_64_index,risk_healthy_index)))/length(Reduce(intersect, list(age_50_64_index,risk_healthy_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index,vaccinated))), 1, first_dose_coverage[11] * length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,vaccinated))), 1, first_dose_coverage[12] * length(Reduce(intersect, list(age_50_64_index,risk_immuno_index)))/length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,vaccinated))))
  
  vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_healthy_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_65_74_index,risk_healthy_index,vaccinated))), 1, first_dose_coverage[13] * length(Reduce(intersect, list(age_65_74_index,risk_healthy_index)))/length(Reduce(intersect, list(age_65_74_index,risk_healthy_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index,vaccinated))), 1, first_dose_coverage[14] * length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_65_74_index,risk_immuno_index,vaccinated))), 1, first_dose_coverage[15] * length(Reduce(intersect, list(age_65_74_index,risk_immuno_index)))/length(Reduce(intersect, list(age_65_74_index,risk_immuno_index,vaccinated))))
  
  vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index,vaccinated))), 1, first_dose_coverage[16] * length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index)))/length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,vaccinated))), 1, first_dose_coverage[17] * length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index,vaccinated))), 1, first_dose_coverage[18] * length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index)))/length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index,vaccinated))))
  
  print(paste0("Percentage of 0-17 years receiving vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$vax == 1))/(length(which(vax_assignment$age_group == "0-17 years"))* 0.967)))
  print(paste0("Percentage of 18-29 years receiving vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "18-29 years"))))
  print(paste0("Percentage of 30-49 years receiving vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "30-49 years"))))
  print(paste0("Percentage of 50-64 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "50-64 years"))))
  print(paste0("Percentage of 65-74 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "65-74 years"))))
  print(paste0("Percentage of 75+ years receiving vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "75+ years"))))
  
  print(paste0("0-17 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy"))* 0.967)))
  print(paste0("18-29 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy"))))
  print(paste0("30-49 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy"))))
  print(paste0("50-64 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy"))))
  print(paste0("65-74 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy"))))
  print(paste0("75+ years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy"))))
  
  print(paste0("0-17 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk"))* 0.967)))
  print(paste0("18-29 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk"))))
  print(paste0("30-49 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk"))))
  print(paste0("50-64 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk"))))
  print(paste0("65-74 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk"))))
  print(paste0("75+ years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk"))))
  
  print(paste0("0-17 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised"))* 0.967)))
  print(paste0("18-29 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised"))))
  print(paste0("30-49 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised"))))
  print(paste0("50-64 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised"))))
  print(paste0("65-74 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised"))))
  print(paste0("75+ years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised"))))
  
  #Assign who is getting the second dose of the updated booster (filter among individuals who have already been assigned with receiving 1 updated booster) 
  second_dose <- which(vax_assignment$vax == 1)
  
  vax_assignment$vax_2[Reduce(intersect, list(age_18_29_index,risk_immuno_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,second_dose))), 1, if_else(second_dose_coverage[6] * length(Reduce(intersect, list(age_18_29_index,risk_immuno_index)))/length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,second_dose))) > 1, 1, second_dose_coverage[6] * length(Reduce(intersect, list(age_18_29_index,risk_immuno_index)))/length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,second_dose)))))
  
  vax_assignment$vax_2[Reduce(intersect, list(age_30_49_index,risk_immuno_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,second_dose))), 1, if_else(second_dose_coverage[9] * length(Reduce(intersect, list(age_30_49_index,risk_immuno_index)))/length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,second_dose))) > 1, 1, second_dose_coverage[9] * length(Reduce(intersect, list(age_30_49_index,risk_immuno_index)))/length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,second_dose)))))
  
  vax_assignment$vax_2[Reduce(intersect, list(age_50_64_index,risk_immuno_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,second_dose))), 1, if_else(second_dose_coverage[12] * length(Reduce(intersect, list(age_50_64_index,risk_immuno_index)))/length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,second_dose))) > 1, 1, second_dose_coverage[12] * length(Reduce(intersect, list(age_50_64_index,risk_immuno_index)))/length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,second_dose)))))
  
  vax_assignment$vax_2[Reduce(intersect, list(age_65_74_index, second_dose))] <- rbinom(length(Reduce(intersect, list(age_65_74_index, second_dose))), 1, if_else(second_dose_coverage[13] * length(Reduce(intersect, list(age_65_74_index)))/length(Reduce(intersect, list(age_65_74_index,second_dose))) > 1, 1, second_dose_coverage[13] * length(Reduce(intersect, list(age_65_74_index)))/length(Reduce(intersect, list(age_65_74_index,second_dose)))))
  vax_assignment$vax_2[Reduce(intersect, list(age_75_plus_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_75_plus_index, second_dose))), 1, if_else(second_dose_coverage[16] * length(Reduce(intersect, list(age_75_plus_index)))/length(Reduce(intersect, list(age_75_plus_index,second_dose))) > 1, 1, second_dose_coverage[16] * length(Reduce(intersect, list(age_75_plus_index)))/length(Reduce(intersect, list(age_75_plus_index,second_dose)))))
  
  print(paste0("Percentage of immunocompromised receiving second dose: ",  length(which(vax_assignment$risk_group %in% c("immunocompromised") & vax_assignment$vax_2 == 1))/length(which(vax_assignment$risk_group %in% c("immunocompromised")))))
  print(paste0("Percentage of 65-74 years receiving second dose: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$vax_2 == 1))/length(which(vax_assignment$age_group == "65-74 years"))))
  print(paste0("Percentage of 75+ years receiving second dose: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$vax_2 == 1))/length(which(vax_assignment$age_group == "75+ years"))))
  
  #distribute booster uptake over next 365 days, according to age distributions
  to_vaccinate_index <- which(vax_assignment$vax == 1)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_0_17_index,risk_healthy_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_0_17_index,risk_healthy_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "0-17 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "0-17 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_0_17_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_0_17_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "0-17 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "0-17 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_0_17_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_0_17_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "0-17 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "0-17 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_18_29_index,risk_healthy_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_18_29_index,risk_healthy_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "18-29 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "18-29 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_18_29_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "18-29 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "18-29 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_18_29_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "18-29 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "18-29 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_30_49_index,risk_healthy_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_30_49_index,risk_healthy_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_30_49_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_50_64_index,risk_healthy_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_50_64_index,risk_healthy_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_50_64_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "75+ years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "75+ years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "75+ years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "75+ years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "75+ years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "75+ years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  #distribute second dose booster uptake over next 365 days, according to age distributions
  to_vaccinate_second_index <- which(vax_assignment$vax_2 == 1)
  
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_18_29_index,risk_immuno_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "18-29 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "30-49 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "50-64 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "65-74 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "65-74 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "65-74 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "75+ years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "75+ years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "75+ years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  
  #Assign anyone receiving dose in 2nd year of simulation the same as 1st year (optimistic, pessimistic)
  #Otherwise, assign vax_val to realistic uptake over period
  if(realistic_ind == 1) {

    #Assign who will receive the updated booster (validation period)
    val_dose <- which(vax_assignment$vax_2 == 1)
    vax_assignment$vax_val[Reduce(intersect, list(age_0_17_index,risk_healthy_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_0_17_index,risk_healthy_index,second_dose))), 1, 0.1194 * length(Reduce(intersect, list(age_0_17_index,risk_healthy_index)))/length(Reduce(intersect, list(age_0_17_index,risk_healthy_index,second_dose))))
    vax_assignment$vax_val[Reduce(intersect, list(age_0_17_index,risk_highrisk_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_0_17_index,risk_highrisk_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_0_17_index,risk_highrisk_index)), second_dose), round(length(Reduce(intersect, list(age_0_17_index,risk_highrisk_index))) * (0.2397 - 0.235)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_0_17_index,risk_immuno_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_0_17_index,risk_immuno_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_0_17_index,risk_immuno_index)), second_dose), round(length(Reduce(intersect, list(age_0_17_index,risk_immuno_index))) * (0.2397 - 0.235)))] <- 1
    
    vax_assignment$vax_val[Reduce(intersect, list(age_18_29_index,risk_healthy_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_18_29_index,risk_healthy_index,second_dose))), 1, 0.0758 * length(Reduce(intersect, list(age_18_29_index,risk_healthy_index)))/length(Reduce(intersect, list(age_18_29_index,risk_healthy_index,second_dose))))
    vax_assignment$vax_val[Reduce(intersect, list(age_18_29_index,risk_highrisk_index,val_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_18_29_index,risk_highrisk_index,val_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_18_29_index,risk_highrisk_index, second_dose)), val_dose), round(length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index)))  * (0.1521 + 0.05 - 0.054)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_18_29_index,risk_immuno_index,val_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_18_29_index,risk_immuno_index,val_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_18_29_index,risk_immuno_index, second_dose)), val_dose), round(length(Reduce(intersect, list(age_18_29_index,risk_immuno_index))) * (0.1521 - 0.054)))] <- 1
    
    vax_assignment$vax_val[Reduce(intersect, list(age_30_49_index,risk_healthy_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_30_49_index,risk_healthy_index,second_dose))), 1, 0.121 * length(Reduce(intersect, list(age_30_49_index,risk_healthy_index)))/length(Reduce(intersect, list(age_30_49_index,risk_healthy_index,second_dose))))
    vax_assignment$vax_val[Reduce(intersect, list(age_30_49_index,risk_highrisk_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_30_49_index,risk_highrisk_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_30_49_index,risk_highrisk_index)), second_dose), round(length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index))) * (0.2428 - 0.2355)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_30_49_index,risk_immuno_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_30_49_index,risk_immuno_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_30_49_index,risk_immuno_index)), second_dose), round(length(Reduce(intersect, list(age_30_49_index,risk_immuno_index))) * (0.2428 - 0.2355)))] <- 1
    
    
    vax_assignment$vax_val[Reduce(intersect, list(age_50_64_index,risk_healthy_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_healthy_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_50_64_index,risk_healthy_index)), second_dose), round(length(Reduce(intersect, list(age_50_64_index,risk_healthy_index))) * (0.1471 - 0.1439)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_50_64_index,risk_highrisk_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_highrisk_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_50_64_index,risk_highrisk_index)), second_dose), round(length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index))) * (0.2953 - 0.2591)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_50_64_index,risk_immuno_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_immuno_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_50_64_index,risk_immuno_index)), second_dose), round(length(Reduce(intersect, list(age_50_64_index,risk_immuno_index))) * (0.2953 - 0.2591)))] <- 1
    
    vax_assignment$vax_val[Reduce(intersect, list(age_65_74_index,risk_healthy_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_healthy_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_65_74_index,risk_healthy_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_65_74_index,risk_healthy_index)), second_dose)) * (0.2334 - 0.2228)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_65_74_index,risk_highrisk_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_65_74_index,risk_highrisk_index)), second_dose)) * (0.4685 - 0.3710)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_65_74_index,risk_immuno_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_immuno_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_65_74_index,risk_immuno_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_65_74_index,risk_immuno_index)), second_dose)) * (0.4685 - 0.3710)))] <- 1
    
    vax_assignment$vax_val[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_75_plus_index,risk_healthy_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_75_plus_index,risk_healthy_index)), second_dose)) * (0.254 - 0.221)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index)), second_dose)) * (0.5097 - 0.3379)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_75_plus_index,risk_immuno_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_75_plus_index,risk_immuno_index)), second_dose)) * (0.5097 - 0.3379)))] <- 1
    
    print(paste0("Percentage of 0-17 years receiving vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years"))* 0.967)))
    print(paste0("Percentage of 18-29 years receiving vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years"))))
    print(paste0("Percentage of 30-49 years receiving vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years"))))
    print(paste0("Percentage of 50-64 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years"))))
    print(paste0("Percentage of 65-74 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years"))))
    print(paste0("Percentage of 75+ years receiving vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years"))))
    
    print(paste0("0-17 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy")) * 0.967)))
    print(paste0("18-29 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("30-49 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("50-64 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("65-74 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("75+ years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy"))))
    
    print(paste0("0-17 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk"))* 0.967)))
    print(paste0("18-29 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("30-49 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("50-64 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("65-74 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("75+ years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk"))))
    
    print(paste0("0-17 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised"))* 0.967)))
    print(paste0("18-29 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("30-49 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("50-64 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("65-74 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("75+ years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised"))))
    
    #distribute booster uptake over next 182 days, according to age distributions
    to_vaccinate_index <- which(vax_assignment$vax_val == 1)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_0_17_index,risk_healthy_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_0_17_index,risk_healthy_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "0-17 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_0_17_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_0_17_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "0-17 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_0_17_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_0_17_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "0-17 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_18_29_index,risk_healthy_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_18_29_index,risk_healthy_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "18-29 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_18_29_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "18-29 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_18_29_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "18-29 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_30_49_index,risk_healthy_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_30_49_index,risk_healthy_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "30-49 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_30_49_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "30-49 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "30-49 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_50_64_index,risk_healthy_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_50_64_index,risk_healthy_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "50-64 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_50_64_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "50-64 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "50-64 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "65-74 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "65-74 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "65-74 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "75+ years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "75+ years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "75+ years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
  } 
  
  if(realistic_ind == 0){
    print("Optimistic or Pessimistic uptake")
    vax_assignment$vax_val <- vax_assignment$vax
    vax_assignment$vaccine_wave_val <- if_else(vax_assignment$vax_val == 1, vax_assignment$vaccine_wave + 365, 0)
    
    print(paste0("Percentage of 0-17 years receiving vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years"))* 0.967)))
    print(paste0("Percentage of 18-29 years receiving vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years"))))
    print(paste0("Percentage of 30-49 years receiving vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years"))))
    print(paste0("Percentage of 50-64 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years"))))
    print(paste0("Percentage of 65-74 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years"))))
    print(paste0("Percentage of 75+ years receiving vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years"))))
    
    print(paste0("0-17 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy"))* 0.967)))
    print(paste0("18-29 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("30-49 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("50-64 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("65-74 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("75+ years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy"))))
    
    print(paste0("0-17 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk"))* 0.967)))
    print(paste0("18-29 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("30-49 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("50-64 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("65-74 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("75+ years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk"))))
    
    print(paste0("0-17 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised"))* 0.967)))
    print(paste0("18-29 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("30-49 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("50-64 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("65-74 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("75+ years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised"))))
  }
  
  return(vax_assignment %>% arrange(individual))
}

#Strategy 9: Universal (Strategy 2) with second dose in key risk group (Strategy 5) - (Hybrid)
strategy_9 <- function(df, first_dose_data, second_dose_data, next_year_dose_data, realistic_ind){
  
  #Assign who is getting vaccinated using age-specific and risk-specific coverage rates
  # NOTE: `vax` and `vax_2` assigns who will get 1st and 2nd boosters based on coverage rates.
  #       `vaccine_wave` and `second_vaccine_wave` assigns when those boosters are administered based on historic uptake
  vax_assignment <- df %>% mutate(vax = 0, vax_2 = 0, vax_val = 0, vaccine_wave = 0, second_vaccine_wave = 0, vaccine_wave_val = 0)
  
  #Pull coverage rates from first and second dose data
  first_dose_coverage <- (first_dose_data %>% filter(week == 52) %>% arrange(age_group, risk_group))$risk_coverage/100
  second_dose_coverage <- (second_dose_data %>% filter(week == 52) %>% arrange(age_group, risk_group))$coverage/100
  
  #For 0-17 years age bin, assume that 96.7% of 0-17 years are older than 6 months (CRUDE ASSUMPTION)
  age_0_17_index <- which(vax_assignment$age_group == "0-17 years")
  age_0_17_index <- sample(age_0_17_index, length(age_0_17_index) * 0.967)
  
  age_18_29_index <- which(vax_assignment$age_group == "18-29 years")
  age_30_49_index <- which(vax_assignment$age_group == "30-49 years")
  age_50_64_index <- which(vax_assignment$age_group == "50-64 years")
  age_65_74_index <- which(vax_assignment$age_group == "65-74 years")
  age_75_plus_index <- which(vax_assignment$age_group == "75+ years")
  
  risk_healthy_index <- which(vax_assignment$risk_group == "healthy")
  risk_highrisk_index <- which(vax_assignment$risk_group == "higher risk")
  risk_immuno_index <- which(vax_assignment$risk_group == "immunocompromised")
  
  vaccinated <- which(vax_assignment$prior_vacc != "unvax")
  
  vax_assignment$vax[Reduce(intersect, list(age_18_29_index,risk_healthy_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_18_29_index,risk_healthy_index,vaccinated))), 1, first_dose_coverage[4] * length(Reduce(intersect, list(age_18_29_index,risk_healthy_index)))/length(Reduce(intersect, list(age_18_29_index,risk_healthy_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_18_29_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index,vaccinated))), 1, if_else(first_dose_coverage[5] * length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index,vaccinated))) > 1, 1, first_dose_coverage[5] * length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index,vaccinated)))))
  vax_assignment$vax[Reduce(intersect, list(age_18_29_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,vaccinated))), 1, if_else(first_dose_coverage[6] * length(Reduce(intersect, list(age_18_29_index,risk_immuno_index)))/length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,vaccinated))) > 1, 1, first_dose_coverage[6] * length(Reduce(intersect, list(age_18_29_index,risk_immuno_index)))/length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,vaccinated)))))
  
  vax_assignment$vax[Reduce(intersect, list(age_30_49_index,risk_healthy_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_30_49_index,risk_healthy_index,vaccinated))), 1, first_dose_coverage[7] * length(Reduce(intersect, list(age_30_49_index,risk_healthy_index)))/length(Reduce(intersect, list(age_30_49_index,risk_healthy_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_30_49_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index,vaccinated))), 1, if_else(first_dose_coverage[8] * length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index,vaccinated))) > 1, 1, first_dose_coverage[8] * length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index,vaccinated)))))
  vax_assignment$vax[Reduce(intersect, list(age_30_49_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,vaccinated))), 1, if_else(first_dose_coverage[9] * length(Reduce(intersect, list(age_30_49_index,risk_immuno_index)))/length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,vaccinated))) > 1, 1, first_dose_coverage[9] * length(Reduce(intersect, list(age_30_49_index,risk_immuno_index)))/length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,vaccinated)))))
  
  vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_healthy_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_50_64_index,risk_healthy_index,vaccinated))), 1, first_dose_coverage[10] * length(Reduce(intersect, list(age_50_64_index,risk_healthy_index)))/length(Reduce(intersect, list(age_50_64_index,risk_healthy_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index,vaccinated))), 1, first_dose_coverage[11] * length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,vaccinated))), 1, first_dose_coverage[12] * length(Reduce(intersect, list(age_50_64_index,risk_immuno_index)))/length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,vaccinated))))
  
  vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_healthy_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_65_74_index,risk_healthy_index,vaccinated))), 1, first_dose_coverage[13] * length(Reduce(intersect, list(age_65_74_index,risk_healthy_index)))/length(Reduce(intersect, list(age_65_74_index,risk_healthy_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index,vaccinated))), 1, first_dose_coverage[14] * length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_65_74_index,risk_immuno_index,vaccinated))), 1, first_dose_coverage[15] * length(Reduce(intersect, list(age_65_74_index,risk_immuno_index)))/length(Reduce(intersect, list(age_65_74_index,risk_immuno_index,vaccinated))))
  
  vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index,vaccinated))), 1, first_dose_coverage[16] * length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index)))/length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,vaccinated))), 1, first_dose_coverage[17] * length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index,vaccinated))), 1, first_dose_coverage[18] * length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index)))/length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index,vaccinated))))
  
  print(paste0("Percentage of 0-17 years receiving vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$vax == 1))/(length(which(vax_assignment$age_group == "0-17 years"))* 0.967)))
  print(paste0("Percentage of 18-29 years receiving vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "18-29 years"))))
  print(paste0("Percentage of 30-49 years receiving vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "30-49 years"))))
  print(paste0("Percentage of 50-64 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "50-64 years"))))
  print(paste0("Percentage of 65-74 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "65-74 years"))))
  print(paste0("Percentage of 75+ years receiving vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "75+ years"))))
  
  print(paste0("0-17 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy"))* 0.967)))
  print(paste0("18-29 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy"))))
  print(paste0("30-49 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy"))))
  print(paste0("50-64 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy"))))
  print(paste0("65-74 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy"))))
  print(paste0("75+ years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy"))))
  
  print(paste0("0-17 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk"))* 0.967)))
  print(paste0("18-29 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk"))))
  print(paste0("30-49 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk"))))
  print(paste0("50-64 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk"))))
  print(paste0("65-74 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk"))))
  print(paste0("75+ years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk"))))
  
  print(paste0("0-17 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised"))* 0.967)))
  print(paste0("18-29 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised"))))
  print(paste0("30-49 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised"))))
  print(paste0("50-64 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised"))))
  print(paste0("65-74 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised"))))
  print(paste0("75+ years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised"))))
  
  #Assign who is getting the second dose of the updated booster (filter among individuals who have already been assigned with receiving 1 updated booster) 
  second_dose <- which(vax_assignment$vax == 1)
  
  vax_assignment$vax_2[Reduce(intersect, list(age_18_29_index,risk_immuno_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,second_dose))), 1, if_else(second_dose_coverage[6] * length(Reduce(intersect, list(age_18_29_index,risk_immuno_index)))/length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,second_dose))) > 1, 1, second_dose_coverage[6] * length(Reduce(intersect, list(age_18_29_index,risk_immuno_index)))/length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,second_dose)))))
  
  vax_assignment$vax_2[Reduce(intersect, list(age_30_49_index,risk_immuno_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,second_dose))), 1, if_else(second_dose_coverage[9] * length(Reduce(intersect, list(age_30_49_index,risk_immuno_index)))/length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,second_dose))) > 1, 1, second_dose_coverage[9] * length(Reduce(intersect, list(age_30_49_index,risk_immuno_index)))/length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,second_dose)))))
  
  vax_assignment$vax_2[Reduce(intersect, list(age_50_64_index,risk_immuno_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,second_dose))), 1, if_else(second_dose_coverage[12] * length(Reduce(intersect, list(age_50_64_index,risk_immuno_index)))/length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,second_dose))) > 1, 1, second_dose_coverage[12] * length(Reduce(intersect, list(age_50_64_index,risk_immuno_index)))/length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,second_dose)))))
  
  vax_assignment$vax_2[Reduce(intersect, list(age_65_74_index, second_dose))] <- rbinom(length(Reduce(intersect, list(age_65_74_index, second_dose))), 1, if_else(second_dose_coverage[13] * length(Reduce(intersect, list(age_65_74_index)))/length(Reduce(intersect, list(age_65_74_index,second_dose))) > 1, 1, second_dose_coverage[13] * length(Reduce(intersect, list(age_65_74_index)))/length(Reduce(intersect, list(age_65_74_index,second_dose)))))
  vax_assignment$vax_2[Reduce(intersect, list(age_75_plus_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_75_plus_index, second_dose))), 1, if_else(second_dose_coverage[16] * length(Reduce(intersect, list(age_75_plus_index)))/length(Reduce(intersect, list(age_75_plus_index,second_dose))) > 1, 1, second_dose_coverage[16] * length(Reduce(intersect, list(age_75_plus_index)))/length(Reduce(intersect, list(age_75_plus_index,second_dose)))))
  
  print(paste0("Percentage of immunocompromised receiving second dose: ",  length(which(vax_assignment$risk_group %in% c("immunocompromised") & vax_assignment$vax_2 == 1))/length(which(vax_assignment$risk_group %in% c("immunocompromised")))))
  print(paste0("Percentage of 65-74 years receiving second dose: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$vax_2 == 1))/length(which(vax_assignment$age_group == "65-74 years"))))
  print(paste0("Percentage of 75+ years receiving second dose: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$vax_2 == 1))/length(which(vax_assignment$age_group == "75+ years"))))
  
  #distribute booster uptake over next 365 days, according to age distributions
  to_vaccinate_index <- which(vax_assignment$vax == 1)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_18_29_index,risk_healthy_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_18_29_index,risk_healthy_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "18-29 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "18-29 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_18_29_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "18-29 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "18-29 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_18_29_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "18-29 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "18-29 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_30_49_index,risk_healthy_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_30_49_index,risk_healthy_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_30_49_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_50_64_index,risk_healthy_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_50_64_index,risk_healthy_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_50_64_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "75+ years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "75+ years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "75+ years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "75+ years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "75+ years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "75+ years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  #distribute second dose booster uptake over next 365 days, according to age distributions
  to_vaccinate_second_index <- which(vax_assignment$vax_2 == 1)
  
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_18_29_index,risk_immuno_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "18-29 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "30-49 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "50-64 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "65-74 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "65-74 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "65-74 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "75+ years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "75+ years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "75+ years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  #Assign anyone receiving dose in 2nd year of simulation the same as 1st year (optimistic, pessimistic)
  #Otherwise, assign vax_val to realistic uptake over period
  if(realistic_ind == 1) {
    
    #Assign who will receive the updated booster (validation period)
    val_dose <- which(vax_assignment$vax_2 == 1)
  
    vax_assignment$vax_val[Reduce(intersect, list(age_18_29_index,risk_healthy_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_18_29_index,risk_healthy_index,second_dose))), 1, 0.0758 * length(Reduce(intersect, list(age_18_29_index,risk_healthy_index)))/length(Reduce(intersect, list(age_18_29_index,risk_healthy_index,second_dose))))
    vax_assignment$vax_val[Reduce(intersect, list(age_18_29_index,risk_highrisk_index,val_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_18_29_index,risk_highrisk_index,val_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_18_29_index,risk_highrisk_index, second_dose)), val_dose), round(length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index)))  * (0.1521 + 0.05 - 0.054)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_18_29_index,risk_immuno_index,val_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_18_29_index,risk_immuno_index,val_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_18_29_index,risk_immuno_index, second_dose)), val_dose), round(length(Reduce(intersect, list(age_18_29_index,risk_immuno_index))) * (0.1521 - 0.054)))] <- 1
    
    vax_assignment$vax_val[Reduce(intersect, list(age_30_49_index,risk_healthy_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_30_49_index,risk_healthy_index,second_dose))), 1, 0.121 * length(Reduce(intersect, list(age_30_49_index,risk_healthy_index)))/length(Reduce(intersect, list(age_30_49_index,risk_healthy_index,second_dose))))
    vax_assignment$vax_val[Reduce(intersect, list(age_30_49_index,risk_highrisk_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_30_49_index,risk_highrisk_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_30_49_index,risk_highrisk_index)), second_dose), round(length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index))) * (0.2428 - 0.2355)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_30_49_index,risk_immuno_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_30_49_index,risk_immuno_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_30_49_index,risk_immuno_index)), second_dose), round(length(Reduce(intersect, list(age_30_49_index,risk_immuno_index))) * (0.2428 - 0.2355)))] <- 1
    
    vax_assignment$vax_val[Reduce(intersect, list(age_50_64_index,risk_healthy_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_healthy_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_50_64_index,risk_healthy_index)), second_dose), round(length(Reduce(intersect, list(age_50_64_index,risk_healthy_index))) * (0.1471 - 0.1439)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_50_64_index,risk_highrisk_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_highrisk_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_50_64_index,risk_highrisk_index)), second_dose), round(length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index))) * (0.2953 - 0.2591)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_50_64_index,risk_immuno_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_immuno_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_50_64_index,risk_immuno_index)), second_dose), round(length(Reduce(intersect, list(age_50_64_index,risk_immuno_index))) * (0.2953 - 0.2591)))] <- 1
    
    vax_assignment$vax_val[Reduce(intersect, list(age_65_74_index,risk_healthy_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_healthy_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_65_74_index,risk_healthy_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_65_74_index,risk_healthy_index)), second_dose)) * (0.2334 - 0.2228)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_65_74_index,risk_highrisk_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_65_74_index,risk_highrisk_index)), second_dose)) * (0.4685 - 0.3710)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_65_74_index,risk_immuno_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_immuno_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_65_74_index,risk_immuno_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_65_74_index,risk_immuno_index)), second_dose)) * (0.4685 - 0.3710)))] <- 1
    
    vax_assignment$vax_val[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_75_plus_index,risk_healthy_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_75_plus_index,risk_healthy_index)), second_dose)) * (0.254 - 0.221)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index)), second_dose)) * (0.5097 - 0.3379)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_75_plus_index,risk_immuno_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_75_plus_index,risk_immuno_index)), second_dose)) * (0.5097 - 0.3379)))] <- 1
    
    print(paste0("Percentage of 0-17 years receiving vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years"))* 0.967)))
    print(paste0("Percentage of 18-29 years receiving vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years"))))
    print(paste0("Percentage of 30-49 years receiving vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years"))))
    print(paste0("Percentage of 50-64 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years"))))
    print(paste0("Percentage of 65-74 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years"))))
    print(paste0("Percentage of 75+ years receiving vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years"))))
    
    print(paste0("0-17 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy")) * 0.967)))
    print(paste0("18-29 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("30-49 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("50-64 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("65-74 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("75+ years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy"))))
    
    print(paste0("0-17 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk"))* 0.967)))
    print(paste0("18-29 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("30-49 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("50-64 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("65-74 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("75+ years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk"))))
    
    print(paste0("0-17 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised"))* 0.967)))
    print(paste0("18-29 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("30-49 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("50-64 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("65-74 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("75+ years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised"))))
    
    #distribute booster uptake over next 182 days, according to age distributions
    to_vaccinate_index <- which(vax_assignment$vax_val == 1)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_18_29_index,risk_healthy_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_18_29_index,risk_healthy_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "18-29 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_18_29_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_18_29_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "18-29 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_18_29_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "18-29 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_30_49_index,risk_healthy_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_30_49_index,risk_healthy_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "30-49 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_30_49_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "30-49 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "30-49 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_50_64_index,risk_healthy_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_50_64_index,risk_healthy_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "50-64 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_50_64_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "50-64 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "50-64 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "65-74 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "65-74 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "65-74 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "75+ years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "75+ years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "75+ years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
  } 
  
  if(realistic_ind == 0){
    print("Optimistic or Pessimistic uptake")
    vax_assignment$vax_val <- vax_assignment$vax
    vax_assignment$vaccine_wave_val <- if_else(vax_assignment$vax_val == 1, vax_assignment$vaccine_wave + 365, 0)
    
    print(paste0("Percentage of 0-17 years receiving vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years"))* 0.967)))
    print(paste0("Percentage of 18-29 years receiving vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years"))))
    print(paste0("Percentage of 30-49 years receiving vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years"))))
    print(paste0("Percentage of 50-64 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years"))))
    print(paste0("Percentage of 65-74 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years"))))
    print(paste0("Percentage of 75+ years receiving vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years"))))
    
    print(paste0("0-17 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy"))* 0.967)))
    print(paste0("18-29 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("30-49 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("50-64 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("65-74 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("75+ years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy"))))
    
    print(paste0("0-17 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk"))* 0.967)))
    print(paste0("18-29 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("30-49 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("50-64 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("65-74 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("75+ years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk"))))
    
    print(paste0("0-17 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised"))* 0.967)))
    print(paste0("18-29 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("30-49 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("50-64 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("65-74 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("75+ years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised"))))
  }
  
  return(vax_assignment %>% arrange(individual))
}

#Strategy 10: Universal (Strategy 3) with second dose in key risk group (Strategy 5) - (Hybrid)
strategy_10 <- function(df, first_dose_data, second_dose_data, next_year_dose_data, realistic_ind){
  
  #Assign who is getting vaccinated using age-specific and risk-specific coverage rates
  # NOTE: `vax` and `vax_2` assigns who will get 1st and 2nd boosters based on coverage rates.
  #       `vaccine_wave` and `second_vaccine_wave` assigns when those boosters are administered based on historic uptake
  vax_assignment <- df %>% mutate(vax = 0, vax_2 = 0, vax_val = 0, vaccine_wave = 0, second_vaccine_wave = 0, vaccine_wave_val = 0)
  
  #Pull coverage rates from first and second dose data
  first_dose_coverage <- (first_dose_data %>% filter(week == 52) %>% arrange(age_group, risk_group))$risk_coverage/100
  second_dose_coverage <- (second_dose_data %>% filter(week == 52) %>% arrange(age_group, risk_group))$coverage/100
  
  #For 0-17 years age bin, assume that 96.7% of 0-17 years are older than 6 months (CRUDE ASSUMPTION)
  age_0_17_index <- which(vax_assignment$age_group == "0-17 years")
  age_0_17_index <- sample(age_0_17_index, length(age_0_17_index) * 0.967)
  
  age_18_29_index <- which(vax_assignment$age_group == "18-29 years")
  age_30_49_index <- which(vax_assignment$age_group == "30-49 years")
  age_50_64_index <- which(vax_assignment$age_group == "50-64 years")
  age_65_74_index <- which(vax_assignment$age_group == "65-74 years")
  age_75_plus_index <- which(vax_assignment$age_group == "75+ years")
  
  risk_healthy_index <- which(vax_assignment$risk_group == "healthy")
  risk_highrisk_index <- which(vax_assignment$risk_group == "higher risk")
  risk_immuno_index <- which(vax_assignment$risk_group == "immunocompromised")
  
  vaccinated <- which(vax_assignment$prior_vacc != "unvax")
  
  vax_assignment$vax[Reduce(intersect, list(age_30_49_index,risk_healthy_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_30_49_index,risk_healthy_index,vaccinated))), 1, first_dose_coverage[7] * length(Reduce(intersect, list(age_30_49_index,risk_healthy_index)))/length(Reduce(intersect, list(age_30_49_index,risk_healthy_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_30_49_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index,vaccinated))), 1, if_else(first_dose_coverage[8] * length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index,vaccinated))) > 1, 1, first_dose_coverage[8] * length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index,vaccinated)))))
  vax_assignment$vax[Reduce(intersect, list(age_30_49_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,vaccinated))), 1, if_else(first_dose_coverage[9] * length(Reduce(intersect, list(age_30_49_index,risk_immuno_index)))/length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,vaccinated))) > 1, 1, first_dose_coverage[9] * length(Reduce(intersect, list(age_30_49_index,risk_immuno_index)))/length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,vaccinated)))))
  
  vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_healthy_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_50_64_index,risk_healthy_index,vaccinated))), 1, first_dose_coverage[10] * length(Reduce(intersect, list(age_50_64_index,risk_healthy_index)))/length(Reduce(intersect, list(age_50_64_index,risk_healthy_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index,vaccinated))), 1, first_dose_coverage[11] * length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,vaccinated))), 1, first_dose_coverage[12] * length(Reduce(intersect, list(age_50_64_index,risk_immuno_index)))/length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,vaccinated))))
  
  vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_healthy_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_65_74_index,risk_healthy_index,vaccinated))), 1, first_dose_coverage[13] * length(Reduce(intersect, list(age_65_74_index,risk_healthy_index)))/length(Reduce(intersect, list(age_65_74_index,risk_healthy_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index,vaccinated))), 1, first_dose_coverage[14] * length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_65_74_index,risk_immuno_index,vaccinated))), 1, first_dose_coverage[15] * length(Reduce(intersect, list(age_65_74_index,risk_immuno_index)))/length(Reduce(intersect, list(age_65_74_index,risk_immuno_index,vaccinated))))
  
  vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index,vaccinated))), 1, first_dose_coverage[16] * length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index)))/length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,vaccinated))), 1, first_dose_coverage[17] * length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index)))/length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,vaccinated))))
  vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,vaccinated))] <- rbinom(length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index,vaccinated))), 1, first_dose_coverage[18] * length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index)))/length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index,vaccinated))))
  
  print(paste0("Percentage of 0-17 years receiving vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$vax == 1))/(length(which(vax_assignment$age_group == "0-17 years"))* 0.967)))
  print(paste0("Percentage of 18-29 years receiving vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "18-29 years"))))
  print(paste0("Percentage of 30-49 years receiving vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "30-49 years"))))
  print(paste0("Percentage of 50-64 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "50-64 years"))))
  print(paste0("Percentage of 65-74 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "65-74 years"))))
  print(paste0("Percentage of 75+ years receiving vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "75+ years"))))
  
  print(paste0("0-17 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy"))* 0.967)))
  print(paste0("18-29 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy"))))
  print(paste0("30-49 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy"))))
  print(paste0("50-64 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy"))))
  print(paste0("65-74 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy"))))
  print(paste0("75+ years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy"))))
  
  print(paste0("0-17 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk"))* 0.967)))
  print(paste0("18-29 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk"))))
  print(paste0("30-49 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk"))))
  print(paste0("50-64 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk"))))
  print(paste0("65-74 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk"))))
  print(paste0("75+ years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk"))))
  
  print(paste0("0-17 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised"))* 0.967)))
  print(paste0("18-29 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised"))))
  print(paste0("30-49 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised"))))
  print(paste0("50-64 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised"))))
  print(paste0("65-74 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised"))))
  print(paste0("75+ years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised"))))
  
  #Assign who is getting the second dose of the updated booster (filter among individuals who have already been assigned with receiving 1 updated booster) 
  second_dose <- which(vax_assignment$vax == 1)
  
  vax_assignment$vax_2[Reduce(intersect, list(age_18_29_index,risk_immuno_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,second_dose))), 1, if_else(second_dose_coverage[6] * length(Reduce(intersect, list(age_18_29_index,risk_immuno_index)))/length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,second_dose))) > 1, 1, second_dose_coverage[6] * length(Reduce(intersect, list(age_18_29_index,risk_immuno_index)))/length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,second_dose)))))
  
  vax_assignment$vax_2[Reduce(intersect, list(age_30_49_index,risk_immuno_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,second_dose))), 1, if_else(second_dose_coverage[9] * length(Reduce(intersect, list(age_30_49_index,risk_immuno_index)))/length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,second_dose))) > 1, 1, second_dose_coverage[9] * length(Reduce(intersect, list(age_30_49_index,risk_immuno_index)))/length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,second_dose)))))
  
  vax_assignment$vax_2[Reduce(intersect, list(age_50_64_index,risk_immuno_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,second_dose))), 1, if_else(second_dose_coverage[12] * length(Reduce(intersect, list(age_50_64_index,risk_immuno_index)))/length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,second_dose))) > 1, 1, second_dose_coverage[12] * length(Reduce(intersect, list(age_50_64_index,risk_immuno_index)))/length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,second_dose)))))
  
  vax_assignment$vax_2[Reduce(intersect, list(age_65_74_index, second_dose))] <- rbinom(length(Reduce(intersect, list(age_65_74_index, second_dose))), 1, if_else(second_dose_coverage[13] * length(Reduce(intersect, list(age_65_74_index)))/length(Reduce(intersect, list(age_65_74_index,second_dose))) > 1, 1, second_dose_coverage[13] * length(Reduce(intersect, list(age_65_74_index)))/length(Reduce(intersect, list(age_65_74_index,second_dose)))))
  vax_assignment$vax_2[Reduce(intersect, list(age_75_plus_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_75_plus_index, second_dose))), 1, if_else(second_dose_coverage[16] * length(Reduce(intersect, list(age_75_plus_index)))/length(Reduce(intersect, list(age_75_plus_index,second_dose))) > 1, 1, second_dose_coverage[16] * length(Reduce(intersect, list(age_75_plus_index)))/length(Reduce(intersect, list(age_75_plus_index,second_dose)))))
  
  print(paste0("Percentage of immunocompromised receiving second dose: ",  length(which(vax_assignment$risk_group %in% c("immunocompromised") & vax_assignment$vax_2 == 1))/length(which(vax_assignment$risk_group %in% c("immunocompromised")))))
  print(paste0("Percentage of 65-74 years receiving second dose: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$vax_2 == 1))/length(which(vax_assignment$age_group == "65-74 years"))))
  print(paste0("Percentage of 75+ years receiving second dose: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$vax_2 == 1))/length(which(vax_assignment$age_group == "75+ years"))))
  
  #distribute booster uptake over next 365 days, according to age distributions
  to_vaccinate_index <- which(vax_assignment$vax == 1)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_30_49_index,risk_healthy_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_30_49_index,risk_healthy_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_30_49_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "30-49 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_50_64_index,risk_healthy_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_50_64_index,risk_healthy_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_50_64_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "50-64 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "65-74 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "75+ years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "75+ years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "75+ years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "75+ years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$vaccine_wave[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_index))] <- sample(c(1:365), length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_index))), prob = c(((first_dose_data %>% filter(age_group == "75+ years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period)[1], rep((first_dose_data %>% filter(age_group == "75+ years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  #distribute second dose booster uptake over next 365 days, according to age distributions
  to_vaccinate_second_index <- which(vax_assignment$vax_2 == 1)
  
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_18_29_index,risk_immuno_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_18_29_index,risk_immuno_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "18-29 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "30-49 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "50-64 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "65-74 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "65-74 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "65-74 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "75+ years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "75+ years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  vax_assignment$second_vaccine_wave[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_second_index))] <- sample(c(240:365), length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_second_index))), prob = c(rep((second_dose_data %>% filter(age_group == "75+ years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
  
  #Assign anyone receiving dose in 2nd year of simulation the same as 1st year (optimistic, pessimistic)
  #Otherwise, assign vax_val to realistic uptake over period
  if(realistic_ind == 1) {
    
    #Assign who will receive the updated booster (validation period)
    val_dose <- which(vax_assignment$vax_2 == 1)
    
    vax_assignment$vax_val[Reduce(intersect, list(age_30_49_index,risk_healthy_index,second_dose))] <- rbinom(length(Reduce(intersect, list(age_30_49_index,risk_healthy_index,second_dose))), 1, 0.121 * length(Reduce(intersect, list(age_30_49_index,risk_healthy_index)))/length(Reduce(intersect, list(age_30_49_index,risk_healthy_index,second_dose))))
    vax_assignment$vax_val[Reduce(intersect, list(age_30_49_index,risk_highrisk_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_30_49_index,risk_highrisk_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_30_49_index,risk_highrisk_index)), second_dose), round(length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index))) * (0.2428 - 0.2355)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_30_49_index,risk_immuno_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_30_49_index,risk_immuno_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_30_49_index,risk_immuno_index)), second_dose), round(length(Reduce(intersect, list(age_30_49_index,risk_immuno_index))) * (0.2428 - 0.2355)))] <- 1
    
    
    vax_assignment$vax_val[Reduce(intersect, list(age_50_64_index,risk_healthy_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_healthy_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_50_64_index,risk_healthy_index)), second_dose), round(length(Reduce(intersect, list(age_50_64_index,risk_healthy_index))) * (0.1471 - 0.1439)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_50_64_index,risk_highrisk_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_highrisk_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_50_64_index,risk_highrisk_index)), second_dose), round(length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index))) * (0.2953 - 0.2591)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_50_64_index,risk_immuno_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_50_64_index,risk_immuno_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_50_64_index,risk_immuno_index)), second_dose), round(length(Reduce(intersect, list(age_50_64_index,risk_immuno_index))) * (0.2953 - 0.2591)))] <- 1
    
    vax_assignment$vax_val[Reduce(intersect, list(age_65_74_index,risk_healthy_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_healthy_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_65_74_index,risk_healthy_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_65_74_index,risk_healthy_index)), second_dose)) * (0.2334 - 0.2228)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_65_74_index,risk_highrisk_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_65_74_index,risk_highrisk_index)), second_dose)) * (0.4685 - 0.3710)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_65_74_index,risk_immuno_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_65_74_index,risk_immuno_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_65_74_index,risk_immuno_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_65_74_index,risk_immuno_index)), second_dose)) * (0.4685 - 0.3710)))] <- 1
    
    vax_assignment$vax_val[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_75_plus_index,risk_healthy_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_75_plus_index,risk_healthy_index)), second_dose)) * (0.254 - 0.221)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index)), second_dose)) * (0.5097 - 0.3379)))] <- 1
    vax_assignment$vax_val[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,second_dose))] <- 1#vax_assignment$vax[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,second_dose))]
    vax_assignment$vax_val[sample(setdiff(Reduce(intersect, list(age_75_plus_index,risk_immuno_index)), second_dose), round(length(setdiff(Reduce(intersect, list(age_75_plus_index,risk_immuno_index)), second_dose)) * (0.5097 - 0.3379)))] <- 1
    
    print(paste0("Percentage of 0-17 years receiving vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years"))* 0.967)))
    print(paste0("Percentage of 18-29 years receiving vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years"))))
    print(paste0("Percentage of 30-49 years receiving vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years"))))
    print(paste0("Percentage of 50-64 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years"))))
    print(paste0("Percentage of 65-74 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years"))))
    print(paste0("Percentage of 75+ years receiving vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years"))))
    
    print(paste0("0-17 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy")) * 0.967)))
    print(paste0("18-29 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("30-49 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("50-64 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("65-74 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("75+ years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy"))))
    
    print(paste0("0-17 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk"))* 0.967)))
    print(paste0("18-29 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("30-49 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("50-64 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("65-74 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("75+ years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk"))))
    
    print(paste0("0-17 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised"))* 0.967)))
    print(paste0("18-29 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("30-49 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("50-64 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("65-74 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("75+ years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised"))))
    
    #distribute booster uptake over next 182 days, according to age distributions
    to_vaccinate_index <- which(vax_assignment$vax_val == 1)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_30_49_index,risk_healthy_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_30_49_index,risk_healthy_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "30-49 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_30_49_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_30_49_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "30-49 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_30_49_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "30-49 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_50_64_index,risk_healthy_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_50_64_index,risk_healthy_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "50-64 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_50_64_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_50_64_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "50-64 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_50_64_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "50-64 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_65_74_index,risk_healthy_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "65-74 years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_65_74_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "65-74 years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_65_74_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "65-74 years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_75_plus_index,risk_healthy_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "75+ years", risk_group == "healthy") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_75_plus_index,risk_highrisk_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "75+ years", risk_group == "higher risk") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    vax_assignment$vaccine_wave_val[Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_index))] <- sample(c((1 + 365):(182 + 365)), length(Reduce(intersect, list(age_75_plus_index,risk_immuno_index,to_vaccinate_index))), prob = c(rep((next_year_dose_data %>% filter(age_group == "75+ years", risk_group == "immunocompromised") %>% arrange(week))$prop_up_to_date_sim_period, each = 7)), replace = TRUE)
    
  } 
  
  if(realistic_ind == 0){
    print("Optimistic or Pessimistic uptake")
    vax_assignment$vax_val <- vax_assignment$vax
    vax_assignment$vaccine_wave_val <- if_else(vax_assignment$vax_val == 1, vax_assignment$vaccine_wave + 365, 0)
    
    print(paste0("Percentage of 0-17 years receiving vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years"))* 0.967)))
    print(paste0("Percentage of 18-29 years receiving vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years"))))
    print(paste0("Percentage of 30-49 years receiving vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years"))))
    print(paste0("Percentage of 50-64 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years"))))
    print(paste0("Percentage of 65-74 years receiving vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years"))))
    print(paste0("Percentage of 75+ years receiving vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years"))))
    
    print(paste0("0-17 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "healthy"))* 0.967)))
    print(paste0("18-29 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("30-49 years, healthy: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("50-64 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("65-74 years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "healthy"))))
    print(paste0("75+ years, healthy: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "healthy"))))
    
    print(paste0("0-17 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "higher risk"))* 0.967)))
    print(paste0("18-29 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("30-49 years, higher risk: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("50-64 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("65-74 years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "higher risk"))))
    print(paste0("75+ years, higher risk: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "higher risk"))))
    
    print(paste0("0-17 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/(length(which(vax_assignment$age_group == "0-17 years" & vax_assignment$risk_group == "immunocompromised"))* 0.967)))
    print(paste0("18-29 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "18-29 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("30-49 years, immunocompromised: % vaccinated: ", length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "30-49 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("50-64 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "50-64 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("65-74 years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "65-74 years" & vax_assignment$risk_group == "immunocompromised"))))
    print(paste0("75+ years, immunocompromised: % vaccinated: ",  length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised" & vax_assignment$vax_val == 1))/length(which(vax_assignment$age_group == "75+ years" & vax_assignment$risk_group == "immunocompromised"))))
  }
  
  return(vax_assignment %>% arrange(individual))
}
